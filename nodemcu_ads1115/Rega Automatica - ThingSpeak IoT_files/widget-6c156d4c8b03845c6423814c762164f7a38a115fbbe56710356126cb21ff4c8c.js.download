ThingSpeak.Widget=function(){var e=function(){var e={CREATE_MODAL_ID:"configure_widget_modal_content_body",WIDGET_TABLE_ID:"#widget_params_config_",MAX_FIELD_WARNING:"Max should be greater than Min",NUM_DISPLAY_SCALE_LIST:"1,2,3,4,5",LAMP_INDICATOR_THRESHOLD_LIST:"is greater than,is greater than or equal to,is less than,is less than or equal to,is equal to,is not equal to"};return{get:function(t){return e[t]}}}(),t=function(t,a){var n={widget_type:a},i=e.get("CREATE_MODAL_ID");$.ajax({method:"GET",url:"/channels/"+t+"/widgets/new.json",data:n,dataType:"json",success:function(e){return ThingSpeak.Widget.constructConfigModal(e.widget_params,e.widget_type,i),e},error:function(){s.showErrorBanner()}})},a=function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=a+n,r=e.params,s=e.enabled_fields;switch(t){case 0:c.formGaugeParams(i,r,s,n,t);break;case 1:c.formNumericDisplayParams(i,r,s,n,t);break;case 2:c.formLampIndicatorParams(i,r,s,n,t)}},n=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a=$(e.get("WIDGET_TABLE_ID")+t),n={},i=!1,r=function(){var e="",t="";this.name.startsWith("range")?(o.getGaugeRange(this,n),i=!0):"name"===this.name?n[this.name]=encodeURIComponent(xssEvasion.sanitizeResponse(this.value.trim())):(e=this.value,t=this.name,n[t]=e)};return a.find(".form-control").each(r),n.range=i?n.range.filter(function(e){return e}):"",n},i=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a={},n=[];n[0]=new Object,n[1]=new Object;var i=n[0],r=n[1],s=e.get("NUM_DISPLAY_SCALE_LIST"),c=$(e.get("WIDGET_TABLE_ID")+t),o=function(e,t){t.selected=$("#"+e)[0].checked?1:0},l=function(){this.name.startsWith("data_type")||(a[this.name]="name"===this.name?encodeURIComponent(xssEvasion.sanitizeResponse(this.value.trim())):this.value)},d=function(){this.name.startsWith("data_type_integer_")&&(i.name="integer",o(this.id,i)),this.name.startsWith("data_type_decimal_")&&(r.name="decimal",o(this.id,r),r.metadata=new Object,r.metadata.scaleRange=s,r.metadata.scaleDefault=document.getElementById("data_type_select_"+t).value)};return c.find(".form-control").each(l),c.find(".radio-control").each(d),a.data_type=n,a},r=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",a={},n=[];n[0]=new Object;var i=n[0],r=e.get("LAMP_INDICATOR_THRESHOLD_LIST"),s=$(e.get("WIDGET_TABLE_ID")+t),c=function(){var e="",s="";this.name.startsWith("threshold_type")?(i.range=r,i["default"]=document.getElementById("threshold_type_"+t).value,a.threshold_type=n):"name"===this.name?a[this.name]=encodeURIComponent(xssEvasion.sanitizeResponse(this.value.trim())):(s=this.name,e=this.value,a[s]=e)};return s.find(".form-control").each(c),a};this.gaugeRemoveRange=function(e){var t=e.getAttributeNode("name").value,a=$("#range_meta_key_"+t).html();""!=document.getElementById("range_meta_key_"+t)&&Number(a)>0&&(document.getElementById("range_meta_key_"+t).innerHTML=Number(a)-1),$(e).parent().remove()},this.disableScaleAndSelectInteger=function(e){var e=void 0!==e?e:"",t=document.getElementById("data_type_select_"+e),a=document.getElementById("data_type_selectText_"+e);t.disabled=!0,a.style.color="grey",$("#data_type_integer_"+e).prop("checked",!0),$("#data_type_decimal_"+e).prop("checked",!1)},this.enableScaleAndSelectDecimal=function(e){var e=void 0!==e?e:"",t=document.getElementById("data_type_select_"+e),a=document.getElementById("data_type_selectText_"+e);t.disabled=!1,a.style.color="black",$("#data_type_integer_"+e).prop("checked",!1),$("#data_type_decimal_"+e).prop("checked",!0)};var s={capitalizeKeys:function(e){var t="";return e.split("_").forEach(function(e){t+=e.charAt(0).toUpperCase()+e.slice(1)+" "}),t.trim()},showErrorBanner:function(){$("#invalid_widget_type").show(),$("#configure_widget_parameters_modal").modal("toggle")}},c={formGaugeParams:function(e,t,a,n,i){var r=0,s=1,c="<table id='widget_params_config_"+n+"'>";for(key in t)switch(key){case"min":case"max":case"tick_interval":c+=o.gaugeTableConfigHelper(key,t[key],"number",n,i);break;case"update_interval":c+=o.gaugeTableConfigHelper(key,t[key],"number",n,i,"second(s)","",s,i);break;case"display_value":c+=o.gaugeTableConfigHelper(key,t[key],"checkbox",n,i);break;case"units":case"name":case"title":case"field":c+=o.setUnitsNameField(key,t,n,a,s,i);break;case"range":r=Object.keys(t[key]).length,c+=o.setGaugeRange(t,key,n)}document.getElementById(e).innerHTML=c+" <br/></table> <span id='gauge_add_range_"+n+"'class='fa fa-plus fa-mid-align' aria-hidden='true'></span> <div id='range_meta_key_"+n+"' style='display: none; onclick='gaugeAddRange(this)'>"+r+"</div><div id='widget_type_metadata_"+n+"' style='display: none;'>"+i+"</div>",o.gaugeDefaultCheckboxVal(n)},formNumericDisplayParams:function(e,t,a,n,i){var r="<table id='widget_params_config_"+n+"'>",s=2;for(key in t)switch(key){case"units":case"name":case"field":r+=o.setUnitsNameField(key,t,n,a,s,i);break;case"update_interval":r+=o.gaugeTableConfigHelper(key,t[key],"number",n,i,"second(s)","",s);break;case"data_type":var c=t[key];r+=o.setNumericDisplayDataType(t[key],key,n)}document.getElementById(e).innerHTML=r+"<div id='widget_type_metadata_"+n+"' style='display: none;'>"+i+"</div>",o.setNumericDisplayRadioOptions(c,n)},formLampIndicatorParams:function(e,t,a,n,i){params=o.fixRawParamsOrder(t);var r="<table id='widget_params_config_"+n+"'>",s=1,c="";for(key in params)switch(key){case"name":r+="<tr>"+o.setUnitsNameField(key,params,n,a,s,i)+"</tr>";break;case"field":case"threshold_type":case"threshold":c+=o.setLampThreshold(key,params,n,a,s,i);break;case"update_interval":r+="<tr>"+c+"</tr>",r+="<tr>"+o.gaugeTableConfigHelper(key,params[key],"number",n,i,"second(s)","",s)+"</tr>";break;case"color":r+=o.setLampColor(params,key,n)}document.getElementById(e).innerHTML=r+"<div id='widget_type_metadata_"+n+"' style='display: none;'>"+i+"</div>"}},o={setUnitsNameField:function(e,t,a,n,i,r){switch(e){case"units":return o.gaugeTableConfigHelper(e,t[e],"text",a,r,"","Enter Measurement Units",i);case"name":case"title":return o.gaugeTableConfigHelper(e,t[e],"text",a,r,"","Enter Name for the widget",i);case"field":var s=t[e].split(",");return o.setFieldDropDown(e,s,a,n,i,r)}},setGaugeRange:function(e,t,a){var n="";n+="<tr><td class='widget-form-label widget-table-cells'>  <label class='control-label'>"+s.capitalizeKeys(t)+" </label></td>";for(var i in e[t])n+="<td class='widget-table-cells'><input class='form-control' type='number' step='any' name='range_start_"+i+"' value='"+(""===e[t][i].start?0:e[t][i].start)+"'></input></td><td class='widget-table-cells'><input class='form-control' type='number' step='any' name='range_end_"+i+"' value='"+(""===e[t][i].end?0:e[t][i].end)+"' > </input></td> <td class='widget-table-cells'><input class='form-control' type='color' name='range_color_"+i+"'  value='"+e[t][i].color+"' >  </input></td><td name='"+a+"' class='color-range-row' onclick='gaugeRemoveRange(this)'><span  class='close' aria-hidden='true'>&times;</span></td><tr></tr><td></td>";return n},setLampColor:function(e,t,a){return colorLabel="<tr><td class='widget-form-label widget-table-cells'><label class='control-label'>"+s.capitalizeKeys(t)+" </label></td>",colorCell="<td><input class='form-control' type='color' id='lamp_color_"+a+"' name='color' value='"+e[t]+"' >  </input></td>",colorLabel+colorCell},setNumericDisplayDataType:function(e,t,a){var n="";n+="<tr><td class='widget-form-label widget-table-cells'>  <label class='control-label'>"+s.capitalizeKeys(t)+" </label></td><td><input style='margin-right:4px;' class='radio-control' id='"+t+"_integer_"+a+"' type='radio' name='"+t+"_integer_"+a+"' onclick='disableScaleAndSelectInteger("+a+")' value='"+s.capitalizeKeys(e[0].name)+"'>"+s.capitalizeKeys(e[0].name)+"</input></td><td><input style='margin-right:4px;' class='radio-control' id='"+t+"_decimal_"+a+"' type='radio' name='"+t+"_decimal_"+a+"' onclick='enableScaleAndSelectDecimal("+a+")' value='"+s.capitalizeKeys(e[1].name)+"'>"+s.capitalizeKeys(e[1].name)+"</input></td>";var i=e[1].metadata.scaleRange.split(",").map(Number),r=Number(e[1].metadata.scaleDefault);return n+=o.setNumericDisplayScale(t,a,i,r)+"</tr>"},setLampThreshold:function(e,t,a,n,i,r){if("field"===e){var s=t[e].split(",");return o.setFieldDropDown(e,s,a,n,i,r)}return"threshold"===e?o.gaugeTableConfigHelper(e,t[e],"number",a,r,"","",i):o.setLampIndicatorThresholdType(t[e],e,a,i)},setNumericDisplayScale:function(e,t,a,n){for(var i="",r="",i=n>0?n:1,s=0;s<a.length;s++)r+=a[s]===i?"<option value='"+i+"' selected> "+i+" </option>":"<option value='"+a[s]+"'> "+a[s]+" </option>";var c="<td><select class='form-control'  disabled ' id='"+e+"_select_"+t+"' name='"+e+"_select_"+t+"'>"+r+"</select></td><td style='font-size: 14px;'><p style='margin-left: 4px;' id='"+e+"_selectText_"+t+"' name='"+e+"_selectText_"+t+"'> (# of places)</p></td>";return c},setLampIndicatorThresholdType:function(e,t,a,n){for(var i="",r=e[0].range.split(","),s=e[0]["default"],c=0==s?0:s,o=0;o<r.length;o++)i+=r[o]===s?"<option value='"+c+"' selected> "+c+" </option>":"<option value='"+r[o]+"'> "+r[o]+" </option>";var l="<td></td>",d="<td colspan='"+n+"' class='widget-table-cells'> <select class='form-control' id='"+t+"_"+a+"' name='"+t+"'>"+i+"</select></td>";return"<tr>"+l+d+"</tr>"},setFieldDropDown:function(e,t,a,n,i,r){var c="",o="",l="";return n.split(",").forEach(1===t.length?function(e){c+=e===t[0]?" <option value='"+t+"' selected> "+t+" </option> ":" <option value='"+e+"'> "+e+" </option> "}:function(e){c+=" <option value='"+e+"'> "+e+" </option> "}),o="<td class='widget-table-cells widget-form-label'> <label class='control-label'>"+s.capitalizeKeys(e)+"</label></td>",2!==r?(l="<td colspan='"+i+"' class='widget-table-cells'> <select class='form-control' id='"+e+"_"+a+"' name='"+e+"'>"+c+"</select></td>","<tr>"+o+l+"</tr>"):(l="<td colspan='"+i+"' class='widget-table-cells'> <select class='form-control' style='margin-top:-0.5em;' id='"+e+"_"+a+"' name='"+e+"'>"+c+"</select></td>",conditionTextRow="<tr><td class='widget-table-cells widget-form-label'><label class='control-label'>Condition</label></td><td>If</td></tr>",fieldRow="<tr><td></td>"+l+"</tr>",conditionTextRow+fieldRow)},gaugeTableConfigHelper:function(t,a,n,i,r){var c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",l=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",d=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"",u=e.get("MAX_FIELD_WARNING"),m="",_="";if("number"===n)var p=o.gaugeSetInputEvent(t);switch(t){case"max":var h="title='"+u+"'";break;case"name":case"title":"title"===t&&(t="name");var g="maxlength=80"}return m="<td class='widget-form-label widget-table-cells'> <label class='control-label'>"+s.capitalizeKeys(t)+"</label></td>","threshold"===t&&2===r?(_="<td colspan='"+d+"' class='widget-table-cells'><input style='margin-bottom:-0.5em';' class='form-control' "+h+" "+g+" placeholder ='"+l+" ' type='"+n+"' "+p+" id='"+t+"_"+i+"' name='"+t+"' value='"+a+"'> </input></td>",thresholdRow="<tr><td></td>"+_+"</tr>",thresholdTextRow="<tr><td class='widget-table-cells widget-form-label'><label class='control-label'></label></td><td>turn Lamp ON</td></tr>",thresholdRow+thresholdTextRow):(_="<td colspan='"+d+"' class='widget-table-cells'><input class='form-control' "+h+" "+g+" placeholder ='"+l+" ' type='"+n+"' "+p+" id='"+t+"_"+i+"' name='"+t+"' value='"+a+"'> </input></td><td class='widget-table-cells'> &nbsp "+c+"</td>","<tr>"+m+_+"</tr>")},fixRawParamsOrder:function(e){var t=new Object;return t.name=e.name,t.field=e.field,t.threshold_type=e.threshold_type,t.threshold=e.threshold,t.update_interval=e.update_interval,t.color=e.color,t},gaugeSetInputEvent:function(e){switch(e){case"min":case"max":return"step='any'";case"tick_interval":return"step='any' oninput='validity.valid||(value=0)' min='0'";case"update_interval":return meter_data.is_free_user?"oninput='validity.valid||(value=15)' min='15'":"oninput='validity.valid||(value=1)' min='1'";case"threshold":return"step='any' oninput='validity.valid||(value=0)' ";default:return""}},gaugeDefaultCheckboxVal:function(e){var t=document.getElementById("display_value_"+e);t.checked="true"==t.value?!0:!1},getGaugeRange:function(e,t){var a,n=[],i={};t.hasOwnProperty("range")&&(n=t.range),gaugeElementValue=e.value,gaugeElementName=e.name.split("_")[1],a=e.name.split("_")[2],i[gaugeElementName]=gaugeElementValue,void 0===n[a]?n[a]=i:(i=n[a],i[gaugeElementName]=gaugeElementValue),t.range=n},setNumericDisplayRadioOptions:function(e,t){1===Number(e[0].selected)&&disableScaleAndSelectInteger(t),1===Number(e[1].selected)&&enableScaleAndSelectDecimal(t)}};return{getNewWidgetFormElements:t,constructConfigModal:a,getGaugeParams:n,getNumericDisplayParams:i,getLampIndicatorParams:r}}();