function unbindBeforeUnloadEvents(){$(window).unbind("beforeunload.channel"),$(document).unbind("page:before-change.channel page:before-unload.channel")}function confirmUnsavedChanges(){var e=$("#unsaved_message").val(),t=channelInfo();unbindBeforeUnloadEvents(),$(window).bind("beforeunload.channel",function(){return channelChanged(t)?e:void 0}),$(document).bind("page:before-change.channel page:before-unload.channel",function(){return channelChanged(t)&&!confirm(e)?!1:void 0})}function channelInfo(){var e=$(":text").get(),t=$(":radio:checked").get(),i=$(":checkbox").get(),n=$("textarea").get(),a=[e,n,t,i].map(function(e){return e.map(function(e){return e.value})});return a.reduce(function(e,t){return e.concat(t)})}function channelChanged(e){if(!elementPresent($("#channel_form")))return!1;if("/channels/new"===window.location.pathname)return!0;var t=channelInfo();if(e.length!==t.length)return!0;for(var i=0;i<e.length;i++)if(t[i]!==e[i])return!0;return!1}function setSchedulable(){switch($("#schedulable_templates").append($(".schedulable_template")),$("#schedulable").html(""),$("#timecontrol_schedulable_type").val()){case"TwitterAccount":$("#schedulable").append($("#thingtweet_template")),disableDateTime(!1);break;case"Thinghttp":$("#schedulable").append($("#thinghttp_template")),disableDateTime(!1);break;case"Talkback":$("#schedulable").append($("#talkback_template")),disableDateTime(!1);break;case"MatlabCode":$("#schedulable").append($("#matlab_code_template")),disableDateTime($("#timecontrol_frequency_hourly").prop("checked")===!0||$("#timecontrol_frequency_minutes").prop("checked")===!0?!0:!1);break;case"MatlabIotAnalytic":ThingSpeak.MatlabIotAnalyticUtility.getMATLABFileNames(),$("#schedulable").append($("#matlab_iot_analytic_template")),disableDateTime($("#timecontrol_frequency_hourly").prop("checked")===!0||$("#timecontrol_frequency_minutes").prop("checked")===!0?!0:!1)}""!==$("#schedulable option:selected").text()?$("#timecontrol-save-button").removeAttr("disabled"):$("#timecontrol-save-button").attr("disabled",!0)}function setWeekdays(){var e=$("#saved_weekdays").val();e.length>0&&$.each(e.split(" "),function(e,t){$('.weekdays[value="'+t+'"]').prop("checked",!0)})}function fixDateTime(){var e=$("#timecontrol_run_at").val(),t=$("#saved_hour").val();if(e.length>0){var i=e.split(" ");$("#timecontrol_run_at").val(i[0])}if(t.length>0){var n=t.split(" ");$("#hour").val(n[0]),$("#minute").val($("#saved_minute").val()),$("#ampm").val(n[1])}}function getStartTime(){$.ajax({url:"calculate_start_time",success:function(e){var t=e.start_time;$("#hour").val(parseInt(t.substring(0,2),10)),$("#minute").val(t.substring(3,5)),$("#second").val(t.substring(6,8)),$("#ampm").val(t.substring(9).toLowerCase()),$("#minute_start_time").text($("#hour").val()+":"+$("#minute").val()+" "+$("#ampm").val())}})}function disableDateTime(e){e?(getStartTime(),$("#frequency_div_time").hide(),$("#frequency_div_start_time").show()):($("#frequency_div_time").show(),$("#frequency_div_start_time").hide())}function recurrancyHandler(){$("#timecontrol_frequency_weekly").prop("checked")===!0?($("#frequency_once_div").hide(),$("#frequency_recurring_div_days").show(),$("#frequency_recurring_div_hours").hide(),$("#frequency_recurring_div_minutes").hide(),$("#frequency_once_div_date").hide(),$("#frequency_recurring_div_choice").show(),setTimeLabel("Time"),disableDateTime(!1)):$("#timecontrol_frequency_daily").prop("checked")===!0?($("#frequency_once_div").hide(),$("#frequency_recurring_div_hours").hide(),$("#frequency_recurring_div_minutes").hide(),$("#frequency_recurring_div_days").hide(),$("#frequency_once_div_date").hide(),$("#frequency_recurring_div_choice").show(),setTimeLabel("Time"),disableDateTime(!1)):$("#timecontrol_frequency_hourly").prop("checked")===!0?($("#frequency_once_div").hide(),$("#frequency_recurring_div_days").hide(),$("#frequency_recurring_div_minutes").hide(),$("#frequency_recurring_div_hours").show(),$("#frequency_once_div_date").hide(),$("#frequency_recurring_div_choice").show(),disableDateTime("MatlabCode"===$("#timecontrol_schedulable_type").val()||"MatlabIotAnalytic"===$("#timecontrol_schedulable_type").val()?!0:!1),setTimeLabel("Start Time")):$("#timecontrol_frequency_minutes").prop("checked")===!0&&($("#frequency_once_div").hide(),$("#frequency_recurring_div_days").hide(),$("#frequency_recurring_div_hours").hide(),$("#frequency_recurring_div_minutes").show(),$("#frequency_once_div_date").hide(),$("#frequency_recurring_div_choice").show(),disableDateTime("MatlabCode"===$("#timecontrol_schedulable_type").val()||"MatlabIotAnalytic"===$("#timecontrol_schedulable_type").val()?!0:!1),setTimeLabel("Start Time")),displayFuzzyTimeOptions()}function setTimeLabel(e){$("#time_label").text(e)}function setWeekdays(){var e=$("#saved_weekdays").val();e.length>0&&$.each(e.split(" "),function(e,t){$('.weekdays[value="'+t+'"]').prop("checked",!0)})}function setFrequencyOption(){$("#timecontrol_frequency_weekly").prop("checked")===!0||$("#timecontrol_frequency_daily").prop("checked")===!0||$("#timecontrol_frequency_hourly").prop("checked")===!0||$("#timecontrol_frequency_minutes").prop("checked")===!0?$("#frequency_recurrance").attr("checked",!0):$("#frequency_once").attr("checked",!0),frequencyHandler()}function frequencyHandler(){$("#frequency_once").prop("checked")===!0?($("#frequency_recurring_div").hide(),$("#frequency_once_div").show(),$("#frequency_recurring_div_choice").hide(),$("#frequency_once_div_date").show(),$("#frequency_recurring_div_hours").hide(),$("#frequency_recurring_div_minutes").hide(),$("#frequency_recurring_div_days").hide(),setTimeLabel("Time"),disableDateTime(!1)):$("#frequency_recurrance").prop("checked")===!0&&($("#frequency_once_div").hide(),$("#frequency_recurring_div").show(),$("#frequency_once_div_date").hide(),$("#frequency_recurring_div_choice").show(),$("input:radio[class='recurrance_radio']").is(":checked")||$("#timecontrol_frequency_weekly").attr("checked",!0),recurrancyHandler())}function displayFuzzyTimeOptions(){if($("#timecontrol_frequency_minutes").prop("checked")===!0&&$("#frequency_once").prop("checked")===!1){recurring_minute=$("#timecontrol_recurring_minute").prop("selectedOptions")[0];var e=recurring_minute.value/2;e=60*e,$("#fuzzy_time option").each(function(){$(this).val()<e?$(this).show():$(this).hide()}),$("#fuzzy_time").val($("#fuzzy_time option:first").val())}else $("#fuzzy_time option").each(function(){$(this).show()})}!function(e,t){"use strict";e.rails!==t&&e.error("jquery-ujs has already been loaded!");var i,n=e(document);e.rails=i={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote]:not([disabled]), a[data-disable-with], a[data-disable]",buttonClickSelector:"button[data-remote]:not([form]):not(form button), button[data-confirm]:not([form]):not(form button)",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type]), input[type=submit][form], input[type=image][form], button[type=submit][form], button[form]:not([type])",disableSelector:"input[data-disable-with]:enabled, button[data-disable-with]:enabled, textarea[data-disable-with]:enabled, input[data-disable]:enabled, button[data-disable]:enabled, textarea[data-disable]:enabled",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled, input[data-disable]:disabled, button[data-disable]:disabled, textarea[data-disable]:disabled",requiredInputSelector:"input[name][required]:not([disabled]), textarea[name][required]:not([disabled])",fileInputSelector:"input[name][type=file]:not([disabled])",linkDisableSelector:"a[data-disable-with], a[data-disable]",buttonDisableSelector:"button[data-remote][data-disable-with], button[data-remote][data-disable]",csrfToken:function(){return e("meta[name=csrf-token]").attr("content")},csrfParam:function(){return e("meta[name=csrf-param]").attr("content")},CSRFProtection:function(e){var t=i.csrfToken();t&&e.setRequestHeader("X-CSRF-Token",t)},refreshCSRFTokens:function(){e('form input[name="'+i.csrfParam()+'"]').val(i.csrfToken())},fire:function(t,i,n){var a=e.Event(i);return t.trigger(a,n),a.result!==!1},confirm:function(e){return confirm(e)},ajax:function(t){return e.ajax(t)},href:function(e){return e[0].href},isRemote:function(e){return e.data("remote")!==t&&e.data("remote")!==!1},handleRemote:function(n){var a,s,r,o,l,c;if(i.fire(n,"ajax:before")){if(o=n.data("with-credentials")||null,l=n.data("type")||e.ajaxSettings&&e.ajaxSettings.dataType,n.is("form")){a=n.data("ujs:submit-button-formmethod")||n.attr("method"),s=n.data("ujs:submit-button-formaction")||n.attr("action"),r=e(n[0]).serializeArray();var u=n.data("ujs:submit-button");u&&(r.push(u),n.data("ujs:submit-button",null)),n.data("ujs:submit-button-formmethod",null),n.data("ujs:submit-button-formaction",null)}else n.is(i.inputChangeSelector)?(a=n.data("method"),s=n.data("url"),r=n.serialize(),n.data("params")&&(r=r+"&"+n.data("params"))):n.is(i.buttonClickSelector)?(a=n.data("method")||"get",s=n.data("url"),r=n.serialize(),n.data("params")&&(r=r+"&"+n.data("params"))):(a=n.data("method"),s=i.href(n),r=n.data("params")||null);return c={type:a||"GET",data:r,dataType:l,beforeSend:function(e,a){return a.dataType===t&&e.setRequestHeader("accept","*/*;q=0.5, "+a.accepts.script),i.fire(n,"ajax:beforeSend",[e,a])?void n.trigger("ajax:send",e):!1},success:function(e,t,i){n.trigger("ajax:success",[e,t,i])},complete:function(e,t){n.trigger("ajax:complete",[e,t])},error:function(e,t,i){n.trigger("ajax:error",[e,t,i])},crossDomain:i.isCrossDomain(s)},o&&(c.xhrFields={withCredentials:o}),s&&(c.url=s),i.ajax(c)}return!1},isCrossDomain:function(e){var t=document.createElement("a");t.href=location.href;var i=document.createElement("a");try{return i.href=e,i.href=i.href,!((!i.protocol||":"===i.protocol)&&!i.host||t.protocol+"//"+t.host==i.protocol+"//"+i.host)}catch(n){return!0}},handleMethod:function(n){var a=i.href(n),s=n.data("method"),r=n.attr("target"),o=i.csrfToken(),l=i.csrfParam(),c=e('<form method="post" action="'+a+'"></form>'),u='<input name="_method" value="'+s+'" type="hidden" />';l===t||o===t||i.isCrossDomain(a)||(u+='<input name="'+l+'" value="'+o+'" type="hidden" />'),r&&c.attr("target",r),c.hide().append(u).appendTo("body"),c.submit()},formElements:function(t,i){return t.is("form")?e(t[0].elements).filter(i):t.find(i)},disableFormElements:function(t){i.formElements(t,i.disableSelector).each(function(){i.disableFormElement(e(this))})},disableFormElement:function(e){var i,n;i=e.is("button")?"html":"val",n=e.data("disable-with"),n!==t&&(e.data("ujs:enable-with",e[i]()),e[i](n)),e.prop("disabled",!0),e.data("ujs:disabled",!0)},enableFormElements:function(t){i.formElements(t,i.enableSelector).each(function(){i.enableFormElement(e(this))})},enableFormElement:function(e){var i=e.is("button")?"html":"val";e.data("ujs:enable-with")!==t&&(e[i](e.data("ujs:enable-with")),e.removeData("ujs:enable-with")),e.prop("disabled",!1),e.removeData("ujs:disabled")},allowAction:function(e){var t,n=e.data("confirm"),a=!1;if(!n)return!0;if(i.fire(e,"confirm")){try{a=i.confirm(n)}catch(s){(console.error||console.log).call(console,s.stack||s)}t=i.fire(e,"confirm:complete",[a])}return a&&t},blankInputs:function(t,i,n){var a,s,r,o,l=e(),c=i||"input,textarea",u=t.find(c),d={};return u.each(function(){a=e(this),a.is("input[type=radio]")?(o=a.attr("name"),d[o]||(0===t.find('input[type=radio]:checked[name="'+o+'"]').length&&(r=t.find('input[type=radio][name="'+o+'"]'),l=l.add(r)),d[o]=o)):(s=a.is("input[type=checkbox],input[type=radio]")?a.is(":checked"):!!a.val(),s===n&&(l=l.add(a)))}),l.length?l:!1},nonBlankInputs:function(e,t){return i.blankInputs(e,t,!0)},stopEverything:function(t){return e(t.target).trigger("ujs:everythingStopped"),t.stopImmediatePropagation(),!1},disableElement:function(e){var n=e.data("disable-with");n!==t&&(e.data("ujs:enable-with",e.html()),e.html(n)),e.bind("click.railsDisable",function(e){return i.stopEverything(e)}),e.data("ujs:disabled",!0)},enableElement:function(e){e.data("ujs:enable-with")!==t&&(e.html(e.data("ujs:enable-with")),e.removeData("ujs:enable-with")),e.unbind("click.railsDisable"),e.removeData("ujs:disabled")}},i.fire(n,"rails:attachBindings")&&(e.ajaxPrefilter(function(e,t,n){e.crossDomain||i.CSRFProtection(n)}),e(window).on("pageshow.rails",function(){e(e.rails.enableSelector).each(function(){var t=e(this);t.data("ujs:disabled")&&e.rails.enableFormElement(t)}),e(e.rails.linkDisableSelector).each(function(){var t=e(this);t.data("ujs:disabled")&&e.rails.enableElement(t)})}),n.on("ajax:complete",i.linkDisableSelector,function(){i.enableElement(e(this))}),n.on("ajax:complete",i.buttonDisableSelector,function(){i.enableFormElement(e(this))}),n.on("click.rails",i.linkClickSelector,function(t){var n=e(this),a=n.data("method"),s=n.data("params"),r=t.metaKey||t.ctrlKey;if(!i.allowAction(n))return i.stopEverything(t);if(!r&&n.is(i.linkDisableSelector)&&i.disableElement(n),i.isRemote(n)){if(r&&(!a||"GET"===a)&&!s)return!0;var o=i.handleRemote(n);return o===!1?i.enableElement(n):o.fail(function(){i.enableElement(n)}),!1}return a?(i.handleMethod(n),!1):void 0}),n.on("click.rails",i.buttonClickSelector,function(t){var n=e(this);if(!i.allowAction(n)||!i.isRemote(n))return i.stopEverything(t);n.is(i.buttonDisableSelector)&&i.disableFormElement(n);var a=i.handleRemote(n);return a===!1?i.enableFormElement(n):a.fail(function(){i.enableFormElement(n)}),!1}),n.on("change.rails",i.inputChangeSelector,function(t){var n=e(this);return i.allowAction(n)&&i.isRemote(n)?(i.handleRemote(n),!1):i.stopEverything(t)}),n.on("submit.rails",i.formSubmitSelector,function(n){var a,s,r=e(this),o=i.isRemote(r);if(!i.allowAction(r))return i.stopEverything(n);if(r.attr("novalidate")===t)if(r.data("ujs:formnovalidate-button")===t){if(a=i.blankInputs(r,i.requiredInputSelector,!1),a&&i.fire(r,"ajax:aborted:required",[a]))return i.stopEverything(n)}else r.data("ujs:formnovalidate-button",t);if(o){if(s=i.nonBlankInputs(r,i.fileInputSelector)){setTimeout(function(){i.disableFormElements(r)},13);var l=i.fire(r,"ajax:aborted:file",[s]);return l||setTimeout(function(){i.enableFormElements(r)},13),l}return i.handleRemote(r),!1}setTimeout(function(){i.disableFormElements(r)},13)}),n.on("click.rails",i.formInputClickSelector,function(t){var n=e(this);if(!i.allowAction(n))return i.stopEverything(t);var a=n.attr("name"),s=a?{name:a,value:n.val()}:null,r=n.closest("form");0===r.length&&(r=e("#"+n.attr("form"))),r.data("ujs:submit-button",s),r.data("ujs:formnovalidate-button",n.attr("formnovalidate")),r.data("ujs:submit-button-formaction",n.attr("formaction")),r.data("ujs:submit-button-formmethod",n.attr("formmethod"))}),n.on("ajax:send.rails",i.formSubmitSelector,function(t){this===t.target&&i.disableFormElements(e(this))}),n.on("ajax:complete.rails",i.formSubmitSelector,function(t){this===t.target&&i.enableFormElements(e(this))}),e(function(){i.refreshCSRFTokens()}))}(jQuery),function(e){e.cookie=function(t,i,n){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(i))||null===i||void 0===i)){if(n=e.extend({},n),(null===i||void 0===i)&&(n.expires=-1),"number"==typeof n.expires){var a=n.expires,s=n.expires=new Date;s.setDate(s.getDate()+a)}return i=String(i),document.cookie=[encodeURIComponent(t),"=",n.raw?i:encodeURIComponent(i),n.expires?"; expires="+n.expires.toUTCString():"",n.path?"; path="+n.path:"",n.domain?"; domain="+n.domain:"",n.secure?"; secure":""].join("")}n=i||{};for(var r,o=n.raw?function(e){return e}:decodeURIComponent,l=document.cookie.split("; "),c=0;r=l[c]&&l[c].split("=");c++)if(o(r[0])===t)return o(r[1]||"");return null}}(jQuery),function(){var e,t,i,n,a,s,r,o,l,c,u,d,h,p,f,m,g,_,v,y,b,w,k,x,$,D,C,T,S,E,P,I,M,N,A,F,L,O,j,H,R,z,q,W,B,U,Y,V,K,G,Q,X,J,Z,et,tt,it=[].indexOf||function(e){for(var t=0,i=this.length;i>t;t++)if(t in this&&this[t]===e)return t;return-1},nt=function(e,t){function i(){this.constructor=e}for(var n in t)at.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},at={}.hasOwnProperty,st=[].slice,rt=function(e,t){return function(){return e.apply(t,arguments)}};N={},h=10,X=!1,j=null,v=null,I=null,z=null,tt=null,n={BEFORE_CHANGE:"page:before-change",FETCH:"page:fetch",RECEIVE:"page:receive",CHANGE:"page:change",UPDATE:"page:update",LOAD:"page:load",RESTORE:"page:restore",BEFORE_UNLOAD:"page:before-unload",EXPIRE:"page:expire"},x=function(e){var t;return e=new i(e),Y(),d(),null!=j&&j.start(),X&&(t=J(e.absolute))?($(t),D(e,null,!1)):D(e,G)},J=function(e){var t;return t=N[e],t&&!t.transitionCacheDisabled?t:void 0},b=function(e){return null==e&&(e=!0),X=e},y=function(e){return null==e&&(e=!0),c?e?null!=j?j:j=new s("html"):(null!=j&&j.uninstall(),j=null):void 0},D=function(e,t,i){return null==i&&(i=!0),Z(n.FETCH,{url:e.absolute}),null!=tt&&tt.abort(),tt=new XMLHttpRequest,tt.open("GET",e.withoutHashForIE10compatibility(),!0),tt.setRequestHeader("Accept","text/html, application/xhtml+xml, application/xml"),tt.setRequestHeader("X-XHR-Referer",z),tt.onload=function(){var i;return Z(n.RECEIVE,{url:e.absolute}),(i=O())?(q(e),W(),p.apply(null,k(i)),M(),"function"==typeof t&&t(),Z(n.LOAD)):document.location.href=_()||e.absolute},j&&i&&(tt.onprogress=function(){return function(e){var t;return t=e.lengthComputable?e.loaded/e.total*100:j.value+(100-j.value)/10,j.advanceTo(t)}}(this)),tt.onloadend=function(){return tt=null},tt.onerror=function(){return document.location.href=e.absolute},tt.send()},$=function(e){return null!=tt&&tt.abort(),p(e.title,e.body),H(e),Z(n.RESTORE)},d=function(){var e;return e=new i(v.url),N[e.absolute]={url:e.relative,body:document.body,title:document.title,positionY:window.pageYOffset,positionX:window.pageXOffset,cachedAt:(new Date).getTime(),transitionCacheDisabled:null!=document.querySelector("[data-no-transition-cache]")},m(h)},F=function(e){return null==e&&(e=h),/^[\d]+$/.test(e)?h=parseInt(e):void 0},m=function(e){var t,i,a,s,r,o;for(r=Object.keys(N),t=r.map(function(e){return N[e].cachedAt}).sort(function(e,t){return t-e}),o=[],i=0,s=r.length;s>i;i++)a=r[i],N[a].cachedAt<=t[e]&&(Z(n.EXPIRE,N[a]),o.push(delete N[a]));return o},p=function(t,i,a,s){return Z(n.BEFORE_UNLOAD),document.title=t,document.documentElement.replaceChild(i,document.body),null!=a&&e.update(a),Q(),s&&w(),v=window.history.state,null!=j&&j.done(),Z(n.CHANGE),Z(n.UPDATE)},w=function(){var e,t,i,n,a,s,r,o,l,c,u,d;for(d=Array.prototype.slice.call(document.body.querySelectorAll('script:not([data-turbolinks-eval="false"])')),i=0,a=d.length;a>i;i++)if(u=d[i],""===(l=u.type)||"text/javascript"===l){for(t=document.createElement("script"),c=u.attributes,n=0,s=c.length;s>n;n++)e=c[n],t.setAttribute(e.name,e.value);u.hasAttribute("async")||(t.async=!1),t.appendChild(document.createTextNode(u.innerHTML)),o=u.parentNode,r=u.nextSibling,o.removeChild(u),o.insertBefore(t,r)}},V=function(e){return e.innerHTML=e.innerHTML.replace(/<noscript[\S\s]*?<\/noscript>/gi,""),e},Q=function(){var e,t;return e=(t=document.querySelectorAll("input[autofocus], textarea[autofocus]"))[t.length-1],e&&document.activeElement!==e?e.focus():void 0},q=function(e){return(e=new i(e)).absolute!==z?window.history.pushState({turbolinks:!0,url:e.absolute},"",e.absolute):void 0},W=function(){var e,t;return(e=tt.getResponseHeader("X-XHR-Redirected-To"))?(e=new i(e),t=e.hasNoHash()?document.location.hash:"",window.history.replaceState(window.history.state,"",e.href+t)):void 0},_=function(){var e;return null!=(e=tt.getResponseHeader("Location"))&&new i(e).crossOrigin()?e:void 0},Y=function(){return z=document.location.href},U=function(){return window.history.replaceState({turbolinks:!0,url:document.location.href},"",document.location.href)},B=function(){return v=window.history.state},M=function(){var e;return navigator.userAgent.match(/Firefox/)&&!(e=new i).hasNoHash()?(window.history.replaceState(v,"",e.withoutHash()),document.location.hash=e.hash):void 0},H=function(e){return window.scrollTo(e.positionX,e.positionY)},G=function(){return document.location.hash?document.location.href=document.location.href:window.scrollTo(0,0)},f=function(e){var t,i,n;if(null==e||"object"!=typeof e)return e;t=new e.constructor;for(i in e)n=e[i],t[i]=f(n);return t},L=function(e){var t,i;return i=(null!=(t=document.cookie.match(new RegExp(e+"=(\\w+)")))?t[1].toUpperCase():void 0)||"",document.cookie=e+"=; expires=Thu, 01-Jan-70 00:00:01 GMT; path=/",i},Z=function(e,t){var i;return"undefined"!=typeof Prototype&&Event.fire(document,e,t,!0),i=document.createEvent("Events"),t&&(i.data=t),i.initEvent(e,!0,!0),document.dispatchEvent(i)},A=function(e){return!Z(n.BEFORE_CHANGE,{url:e})},O=function(){var e,t,i,n,a,s;return t=function(){var e;return 400<=(e=tt.status)&&600>e},s=function(){var e;return null!=(e=tt.getResponseHeader("Content-Type"))&&e.match(/^(?:text\/html|application\/xhtml\+xml|application\/xml)(?:;|$)/)},n=function(e){var t,i,n,a,s;for(a=e.querySelector("head").childNodes,s=[],t=0,i=a.length;i>t;t++)n=a[t],null!=("function"==typeof n.getAttribute?n.getAttribute("data-turbolinks-track"):void 0)&&s.push(n.getAttribute("src")||n.getAttribute("href"));return s},e=function(e){var t;return I||(I=n(document)),t=n(e),t.length!==I.length||a(t,I).length!==I.length},a=function(e,t){var i,n,a,s,r;for(e.length>t.length&&(a=[t,e],e=a[0],t=a[1]),s=[],i=0,n=e.length;n>i;i++)r=e[i],it.call(t,r)>=0&&s.push(r);return s},!t()&&s()&&(i=g(tt.responseText),i&&!e(i))?i:void 0},k=function(t){var i;return i=t.querySelector("title"),[null!=i?i.textContent:void 0,V(t.querySelector("body")),e.get(t).token,"runScripts"]},e={get:function(e){var t;return null==e&&(e=document),{node:t=e.querySelector('meta[name="csrf-token"]'),token:null!=t&&"function"==typeof t.getAttribute?t.getAttribute("content"):void 0}},update:function(e){var t;return t=this.get(),null!=t.token&&null!=e&&t.token!==e?t.node.setAttribute("content",e):void 0}},g=function(e){var t;return t=document.documentElement.cloneNode(),t.innerHTML=e,t.head=t.querySelector("head"),t.body=t.querySelector("body"),t},i=function(){function e(t){return this.original=null!=t?t:document.location.href,this.original.constructor===e?this.original:void this._parse()}return e.prototype.withoutHash=function(){return this.href.replace(this.hash,"").replace("#","")},e.prototype.withoutHashForIE10compatibility=function(){return this.withoutHash()},e.prototype.hasNoHash=function(){return 0===this.hash.length},e.prototype.crossOrigin=function(){return this.origin!==(new e).origin},e.prototype._parse=function(){var e;return(null!=this.link?this.link:this.link=document.createElement("a")).href=this.original,e=this.link,this.href=e.href,this.protocol=e.protocol,this.host=e.host,this.hostname=e.hostname,this.port=e.port,this.pathname=e.pathname,this.search=e.search,this.hash=e.hash,this.origin=[this.protocol,"//",this.hostname].join(""),0!==this.port.length&&(this.origin+=":"+this.port),this.relative=[this.pathname,this.search,this.hash].join(""),this.absolute=this.href},e}(),a=function(e){function t(e){return this.link=e,this.link.constructor===t?this.link:(this.original=this.link.href,this.originalElement=this.link,this.link=this.link.cloneNode(!1),void t.__super__.constructor.apply(this,arguments))}return nt(t,e),t.HTML_EXTENSIONS=["html"],t.allowExtensions=function(){var e,i,n,a;for(i=1<=arguments.length?st.call(arguments,0):[],n=0,a=i.length;a>n;n++)e=i[n],t.HTML_EXTENSIONS.push(e);return t.HTML_EXTENSIONS},t.prototype.shouldIgnore=function(){return this.crossOrigin()||this._anchored()||this._nonHtml()||this._optOut()||this._target()},t.prototype._anchored=function(){return(this.hash.length>0||"#"===this.href.charAt(this.href.length-1))&&this.withoutHash()===(new i).withoutHash()},t.prototype._nonHtml=function(){return this.pathname.match(/\.[a-z]+$/g)&&!this.pathname.match(new RegExp("\\.(?:"+t.HTML_EXTENSIONS.join("|")+")?$","g"))},t.prototype._optOut=function(){var e,t;for(t=this.originalElement;!e&&t!==document;)e=null!=t.getAttribute("data-no-turbolink"),t=t.parentNode;return e},t.prototype._target=function(){return 0!==this.link.target.length},t}(i),t=function(){function e(e){this.event=e,this.event.defaultPrevented||(this._extractLink(),this._validForTurbolinks()&&(A(this.link.absolute)||et(this.link.href),this.event.preventDefault()))}return e.installHandlerLast=function(t){return t.defaultPrevented?void 0:(document.removeEventListener("click",e.handle,!1),document.addEventListener("click",e.handle,!1))},e.handle=function(t){return new e(t)},e.prototype._extractLink=function(){var e;for(e=this.event.target;e.parentNode&&"A"!==e.nodeName;)e=e.parentNode;return"A"===e.nodeName&&0!==e.href.length?this.link=new a(e):void 0},e.prototype._validForTurbolinks=function(){return null!=this.link&&!(this.link.shouldIgnore()||this._nonStandardClick())},e.prototype._nonStandardClick=function(){return this.event.which>1||this.event.metaKey||this.event.ctrlKey||this.event.shiftKey||this.event.altKey},e}(),s=function(){function e(e){this.elementSelector=e,this._trickle=rt(this._trickle,this),this.value=0,this.content="",this.speed=300,this.opacity=.99,this.install()}var t;return t="turbolinks-progress-bar",e.prototype.install=function(){return this.element=document.querySelector(this.elementSelector),this.element.classList.add(t),this.styleElement=document.createElement("style"),document.head.appendChild(this.styleElement),this._updateStyle()},e.prototype.uninstall=function(){return this.element.classList.remove(t),document.head.removeChild(this.styleElement)},e.prototype.start=function(){return this.advanceTo(5)},e.prototype.advanceTo=function(e){var t;if(e>(t=this.value)&&100>=t){if(this.value=e,this._updateStyle(),100===this.value)return this._stopTrickle();if(this.value>0)return this._startTrickle()}},e.prototype.done=function(){return this.value>0?(this.advanceTo(100),this._reset()):void 0},e.prototype._reset=function(){var e;return e=this.opacity,setTimeout(function(e){return function(){return e.opacity=0,e._updateStyle()}}(this),this.speed/2),setTimeout(function(t){return function(){return t.value=0,t.opacity=e,t._withSpeed(0,function(){return t._updateStyle(!0)})}}(this),this.speed)},e.prototype._startTrickle=function(){return this.trickling?void 0:(this.trickling=!0,setTimeout(this._trickle,this.speed))},e.prototype._stopTrickle=function(){return delete this.trickling},e.prototype._trickle=function(){return this.trickling?(this.advanceTo(this.value+Math.random()/2),setTimeout(this._trickle,this.speed)):void 0},e.prototype._withSpeed=function(e,t){var i,n;return i=this.speed,this.speed=e,n=t(),this.speed=i,n},e.prototype._updateStyle=function(e){return null==e&&(e=!1),e&&this._changeContentToForceRepaint(),this.styleElement.textContent=this._createCSSRule()},e.prototype._changeContentToForceRepaint=function(){return this.content=""===this.content?" ":""},e.prototype._createCSSRule=function(){return this.elementSelector+"."+t+"::before {\n  content: '"+this.content+"';\n  position: fixed;\n  top: 0;\n  left: 0;\n  z-index: 2000;\n  background-color: #0076ff;\n  height: 3px;\n  opacity: "+this.opacity+";\n  width: "+this.value+"%;\n  transition: width "+this.speed+"ms ease-out, opacity "+this.speed/2+"ms ease-in;\n  transform: translate3d(0,0,0);\n}"},e}(),u=function(e){return setTimeout(e,500)},S=function(){return document.addEventListener("DOMContentLoaded",function(){return Z(n.CHANGE),Z(n.UPDATE)},!0)},P=function(){return"undefined"!=typeof jQuery?jQuery(document).on("ajaxSuccess",function(e,t){return jQuery.trim(t.responseText)?Z(n.UPDATE):void 0}):void 0},E=function(e){var t,n;return(null!=(n=e.state)?n.turbolinks:void 0)?(t=N[new i(e.state.url).absolute])?(d(),$(t)):et(e.target.location.href):void 0},T=function(){return U(),B(),document.addEventListener("click",t.installHandlerLast,!0),window.addEventListener("hashchange",function(){return U(),B()},!1),u(function(){return window.addEventListener("popstate",E,!1)})},C=void 0!==window.history.state||navigator.userAgent.match(/Firefox\/2[6|7]/),l=window.history&&window.history.pushState&&window.history.replaceState&&C,r=!navigator.userAgent.match(/CriOS\//),K="GET"===(R=L("request_method"))||""===R,c=l&&r&&K,o=document.addEventListener&&document.createEvent,o&&(S(),P()),c?(et=x,T()):et=function(e){return document.location.href=e},this.Turbolinks={visit:et,pagesCached:F,enableTransitionCache:b,enableProgressBar:y,allowLinkExtensions:a.allowExtensions,supported:c,EVENTS:f(n)}}.call(this),function(e){function t(){var t=i(this);return isNaN(t.datetime)||e(this).text(n(t.datetime)),this}function i(t){if(t=e(t),!t.data("timeago")){t.data("timeago",{datetime:s.datetime(t)});var i=e.trim(t.text());i.length>0&&t.attr("title",i)}return t.data("timeago")}function n(e){return s.inWords(a(e))}function a(e){return(new Date).getTime()-e.getTime()}e.timeago=function(t){return n(t instanceof Date?t:"string"==typeof t?e.timeago.parse(t):e.timeago.datetime(t))};var s=e.timeago;e.extend(e.timeago,{settings:{refreshMillis:6e4,allowFuture:!1,strings:{prefixAgo:null,prefixFromNow:null,suffixAgo:"ago",suffixFromNow:"from now",seconds:"less than a minute",minute:"about a minute",minutes:"%d minutes",hour:"about an hour",hours:"about %d hours",day:"a day",days:"%d days",month:"about a month",months:"%d months",year:"about a year",years:"%d years",numbers:[]}},inWords:function(t){function i(i,a){var s=e.isFunction(i)?i(a,t):i,r=n.numbers&&n.numbers[a]||a;return s.replace(/%d/i,r)}var n=this.settings.strings,a=n.prefixAgo,s=n.suffixAgo;this.settings.allowFuture&&(0>t&&(a=n.prefixFromNow,s=n.suffixFromNow),t=Math.abs(t));var r=t/1e3,o=r/60,l=o/60,c=l/24,u=c/365,d=45>r&&i(n.seconds,Math.round(r))||90>r&&i(n.minute,1)||45>o&&i(n.minutes,Math.round(o))||90>o&&i(n.hour,1)||24>l&&i(n.hours,Math.round(l))||48>l&&i(n.day,1)||30>c&&i(n.days,Math.floor(c))||60>c&&i(n.month,1)||365>c&&i(n.months,Math.floor(c/30))||2>u&&i(n.year,1)||i(n.years,Math.floor(u));return e.trim([a,d,s].join(" "))},parse:function(t){var i=e.trim(t);return i=i.replace(/\.\d\d\d+/,""),i=i.replace(/-/,"/").replace(/-/,"/"),i=i.replace(/T/," ").replace(/Z/," UTC"),i=i.replace(/([\+\-]\d\d)\:?(\d\d)/," $1$2"),new Date(i)},datetime:function(t){var i="time"===e(t).get(0).tagName.toLowerCase(),n=e(t).attr(i?"datetime":"title");return s.parse(n)}}),e.fn.timeago=function(){var e=this;e.each(t);var i=s.settings;return i.refreshMillis>0&&setInterval(function(){e.each(t)},i.refreshMillis),e},document.createElement("abbr"),document.createElement("time")}(jQuery),function(e){window.NestedFormEvents=function(){this.addFields=e.proxy(this.addFields,this),this.removeFields=e.proxy(this.removeFields,this)},NestedFormEvents.prototype={addFields:function(t){var i=t.currentTarget,n=e(i).data("association"),a=e("#"+e(i).data("blueprint-id")),s=a.data("blueprint"),r=(e(i).closest(".fields").closestChild("input, textarea, select").eq(0).attr("name")||"").replace(new RegExp("[[a-z_]+]$"),"");if(r)for(var o=r.match(/[a-z_]+_attributes(?=\]\[(new_)?\d+\])/g)||[],l=r.match(/[0-9]+/g)||[],c=0;c<o.length;c++)l[c]&&(s=s.replace(new RegExp("(_"+o[c]+")_.+?_","g"),"$1_"+l[c]+"_"),s=s.replace(new RegExp("(\\["+o[c]+"\\])\\[.+?\\]","g"),"$1["+l[c]+"]"));var u=new RegExp("new_"+n,"g"),d=this.newId();s=e.trim(s.replace(u,d));var h=this.insertFields(s,n,i);return h.trigger({type:"nested:fieldAdded",field:h}).trigger({type:"nested:fieldAdded:"+n,field:h}),!1},newId:function(){return(new Date).getTime()},insertFields:function(t,i,n){var a=e(n).data("target");return a?e(t).appendTo(e(a)):e(t).insertBefore(n)},removeFields:function(t){var i=e(t.currentTarget),n=i.data("association"),a=i.prev("input[type=hidden]");a.val("1");var s=i.closest(".fields");return s.hide(),s.trigger({type:"nested:fieldRemoved",field:s}).trigger({type:"nested:fieldRemoved:"+n,field:s}),!1}},window.nestedFormEvents=new NestedFormEvents,e(document).delegate("form a.add_nested_fields","click",nestedFormEvents.addFields).delegate("form a.remove_nested_fields","click",nestedFormEvents.removeFields)}(jQuery),function(e){e.fn.closestChild=function(t){if(t&&""!=t){var i=[];for(i.push(this);i.length>0;)for(var n=i.shift(),a=n.children(),s=0;s<a.length;++s){var r=e(a[s]);if(r.is(t))return r;i.push(r)}}return e()}}(jQuery);var wloc=window.location.toString();-1!==wloc.indexOf("api.")&&wloc.indexOf("api.")<20&&-1===wloc.indexOf("charts")&&-1===wloc.indexOf("plugins")&&(window.location=-1!==wloc.indexOf("-api.")?wloc.replace("api","web"):wloc.replace("api","www")),function(e){function t(t,n,a,s){l={dataType:"json"},1===arguments.length&&"string"!=typeof arguments[0]?(l=e.extend(l,t),"url"in l&&"data"in l&&i(l.url,l.data)):(e.isFunction(n)&&(s=a,a=n,n=null),t=i(t,n),l=e.extend(l,{url:t,data:n,success:a,error:s}))
}function i(e,t){var i,n,a;for(i in t)a=t[i],n=e.replace("{"+i+"}",a),n!=e&&(e=n,delete t[i]);return e}function n(t){return t.type=t.type||"GET","string"!=typeof t.data&&null!=t.data&&(t.data=e.param(t.data)),t.data=t.data||"",e.restSetup.csrf&&!e.isEmptyObject(e.restSetup.csrf)&&(/^(get)$/i.test(t.type)||/(authenticity_token=)/i.test(t.data)||(t.data+=(t.data?"&":"")+e.restSetup.csrfParam+"="+$restSetup.csrfToken)),/^(get|post)$/i.test(t.type)||(t.data+=(t.data?"&":"")+e.restSetup.methodParam+"="+t.type.toLowerCase(),t.type="POST"),c.call(this,t)}function a(){return t.apply(this,arguments),e.extend(l,{type:"GET"}),e.ajax(l)}function s(){return t.apply(this,arguments),e.extend(l,{type:"POST"}),e.ajax(l)}function r(){return t.apply(this,arguments),e.extend(l,{type:"PUT"}),e.ajax(l)}function o(){return t.apply(this,arguments),e.extend(l,{type:"DELETE"}),e.ajax(l)}e.restSetup={methodParam:"_method"},e(document).on("page:load ready",function(){e.extend(e.restSetup,{csrfParam:e("meta[name=csrf-param]").attr("content"),csrfToken:e("meta[name=csrf-token]").attr("content")})});var l,c=e.ajax;e.extend({ajax:n,read:a,create:s,update:r,destroy:o})}(jQuery),function(e,t,i){var n={required:"The %s field is required.",matches:"The %s field does not match the %s field.",valid_email:"The %s field must contain a valid email address.",min_length:"The %s field must be at least %s characters in length.",max_length:"The %s field must not exceed %s characters in length.",exact_length:"The %s field must be exactly %s characters in length.",greater_than:"The %s field must contain a number greater than %s.",less_than:"The %s field must contain a number less than %s.",alpha:"The %s field must only contain alphabetical characters.",alpha_numeric:"The %s field must only contain alpha-numeric characters.",alpha_dash:"The %s field must only contain alpha-numeric characters, underscores, and dashes.",numeric:"The %s field must contain only numbers.",integer:"The %s field must contain an integer."},a=function(){},s=/^(.+)\[(.+)\]$/,r=/^[0-9]+$/,o=/^\-?[0-9]+$/,l=/^\-?[0-9]*\.?[0-9]+$/,c=/^[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,6}$/i,u=/^[a-z]+$/i,d=/^[a-z0-9]+$/i,h=/^[a-z0-9_-]+$/i,p=function(e,i,n){for(this.callback=n||a,this.errors=[],this.fields={},this.form=t.forms[e]||{},this.messages={},this.handlers={},e=0,n=i.length;n>e;e++){var s=i[e];s.name&&s.rules&&(this.fields[s.name]={name:s.name,display:s.display||s.name,rules:s.rules,type:null,value:null,checked:null})}this.form.onsubmit=function(e){return function(t){try{return e._validateForm(t)}catch(i){}}}(this)};p.prototype.setMessage=function(e,t){return this.messages[e]=t,this},p.prototype.registerCallback=function(e,t){return e&&"string"==typeof e&&t&&"function"==typeof t&&(this.handlers[e]=t),this},p.prototype._validateForm=function(e){this.errors=[];for(var t in this.fields)if(this.fields.hasOwnProperty(t)){var n=this.fields[t]||{},a=this.form[n.name];a&&a!==i&&(n.type=a.type,n.value=a.value,n.checked=a.checked),this._validateField(n)}if("function"==typeof this.callback&&this.callback(this.errors,e),this.errors.length>0){if(!e||!e.preventDefault)return!1;e.preventDefault()}return!0},p.prototype._validateField=function(e){var t=e.rules.split("|");if(-1!==e.rules.indexOf("required")||e.value&&""!==e.value&&e.value!==i)for(var a=0,r=t.length;r>a;a++){var o=t[a],l=null,c=!1;if((parts=s.exec(o))&&(o=parts[1],l=parts[2]),"function"==typeof this._hooks[o]?this._hooks[o].apply(this,[e,l])||(c=!0):"callback_"===o.substring(0,9)&&(o=o.substring(9,o.length),"function"==typeof this.handlers[o]&&this.handlers[o].apply(this,[e.value])===!1&&(c=!0)),c){(t=this.messages[o]||n[o])?(e=t.replace("%s",e.display),l&&(e=e.replace("%s",this.fields[l]?this.fields[l].display:l)),this.errors.push(e)):this.errors.push("An error has occurred with the "+e.display+" field.");break}}},p.prototype._hooks={required:function(e){var t=e.value;return"checkbox"===e.type?e.checked===!0:null!==t&&""!==t},matches:function(e,t){return(el=this.form[t])?e.value===el.value:!1},valid_email:function(e){return c.test(e.value)},min_length:function(e,t){return r.test(t)?e.value.length>=t:!1},max_length:function(e,t){return r.test(t)?e.value.length<=t:!1},exact_length:function(e,t){return r.test(t)?e.value.length==t:!1},greater_than:function(e,t){return l.test(e.value)?parseFloat(e.value)>parseFloat(t):!1},less_than:function(e,t){return l.test(e.value)?parseFloat(e.value)<parseFloat(t):!1},alpha:function(e){return u.test(e.value)},alpha_numeric:function(e){return d.test(e.value)},alpha_dash:function(e){return h.test(e.value)},numeric:function(e){return l.test(e.value)},integer:function(e){return o.test(e.value)}},e.FormValidator=p}(window,document),$(document).on("page:load ready",function(){elementPresent($("#channel_form"))&&($(".field_checkbox").click(function(){var e=$(this).val(),t=$("#channel_field"+e);$(this).is(":checked")?(t.removeAttr("readonly"),t.val("Field Label "+e),t.select()):(t.val(""),t.attr("readonly",!0))}),$("#channel_show_location").click(function(){$(this).is(":checked")?($("#channel_longitude").removeAttr("readonly"),$("#channel_latitude").removeAttr("readonly"),$("#label_longitude").removeClass("label-disabled"),$("#label_latitude").removeClass("label-disabled")):($("#channel_longitude").attr("readonly",!0),$("#channel_latitude").attr("readonly",!0),$("#label_longitude").addClass("label-disabled"),$("#label_latitude").addClass("label-disabled"))}),$("#channel_show_video").click(function(){$(this).is(":checked")?($('[name="channel[video_type]"]:radio').removeAttr("disabled"),$("#channel_video_id").removeAttr("readonly"),$("#label_youtube").removeClass("label-disabled"),$("#label_vimeo").removeClass("label-disabled"),$("#label_video_id").removeClass("label-disabled")):($('[name="channel[video_type]"]:radio').attr("disabled",!0),$("#channel_video_id").attr("readonly",!0),$("#label_youtube").addClass("label-disabled"),$("#label_vimeo").addClass("label-disabled"),$("#label_video_id").addClass("label-disabled"))}),$("form").submit(function(){$('[name="channel[video_type]"]:radio').removeAttr("disabled"),unbindBeforeUnloadEvents()}),confirmUnsavedChanges())});var elementPresent=function(e){return"string"==typeof e?0!==$(e).length:0!==e.length};$(window).on("page:load load",function(){var e=-90;$.fn.affix&&(setTimeout(function(){$("#bootstrap-sidebar").affix()},100),$(document.body).scrollspy({target:"#leftcol",offset:300}),$("#bootstrap-sidebar li a[href^='#']").on("click",function(t){t.preventDefault();var i=this.hash;$("html, body").animate({scrollTop:$(this.hash).offset().top+e},300,function(){window.location.hash=i})}))});var q=null;window.PR_SHOULD_USE_CONTINUATION=!0,function(){function e(e){function t(e){var t=e.charCodeAt(0);if(92!==t)return t;var i=e.charAt(1);return(t=d[i])?t:i>="0"&&"7">=i?parseInt(e.substring(1),8):"u"===i||"x"===i?parseInt(e.substring(2),16):e.charCodeAt(1)}function i(e){return 32>e?(16>e?"\\x0":"\\x")+e.toString(16):(e=String.fromCharCode(e),("\\"===e||"-"===e||"["===e||"]"===e)&&(e="\\"+e),e)}function n(e){for(var n=e.substring(1,e.length-1).match(/\\u[\dA-Fa-f]{4}|\\x[\dA-Fa-f]{2}|\\[0-3][0-7]{0,2}|\\[0-7]{1,2}|\\[\S\s]|[^\\]/g),e=[],a=[],s="^"===n[0],r=s?1:0,o=n.length;o>r;++r){var l=n[r];if(/\\[bdsw]/i.test(l))e.push(l);else{var c,l=t(l);o>r+2&&"-"===n[r+1]?(c=t(n[r+2]),r+=2):c=l,a.push([l,c]),65>c||l>122||(65>c||l>90||a.push([32|Math.max(65,l),32|Math.min(c,90)]),97>c||l>122||a.push([-33&Math.max(97,l),-33&Math.min(c,122)]))}}for(a.sort(function(e,t){return e[0]-t[0]||t[1]-e[1]}),n=[],l=[0/0,0/0],r=0;r<a.length;++r)o=a[r],o[0]<=l[1]+1?l[1]=Math.max(l[1],o[1]):n.push(l=o);for(a=["["],s&&a.push("^"),a.push.apply(a,e),r=0;r<n.length;++r)o=n[r],a.push(i(o[0])),o[1]>o[0]&&(o[1]+1>o[0]&&a.push("-"),a.push(i(o[1])));return a.push("]"),a.join("")}function a(e){for(var t=e.source.match(/\[(?:[^\\\]]|\\[\S\s])*]|\\u[\dA-Fa-f]{4}|\\x[\dA-Fa-f]{2}|\\\d+|\\[^\dux]|\(\?[!:=]|[()^]|[^()[\\^]+/g),i=t.length,a=[],o=0,l=0;i>o;++o){var c=t[o];"("===c?++l:"\\"===c.charAt(0)&&(c=+c.substring(1))&&l>=c&&(a[c]=-1)}for(o=1;o<a.length;++o)-1===a[o]&&(a[o]=++s);for(l=o=0;i>o;++o)c=t[o],"("===c?(++l,void 0===a[l]&&(t[o]="(?:")):"\\"===c.charAt(0)&&(c=+c.substring(1))&&l>=c&&(t[o]="\\"+a[l]);for(l=o=0;i>o;++o)"^"===t[o]&&"^"!==t[o+1]&&(t[o]="");if(e.ignoreCase&&r)for(o=0;i>o;++o)c=t[o],e=c.charAt(0),c.length>=2&&"["===e?t[o]=n(c):"\\"!==e&&(t[o]=c.replace(/[A-Za-z]/g,function(e){return e=e.charCodeAt(0),"["+String.fromCharCode(-33&e,32|e)+"]"}));return t.join("")}for(var s=0,r=!1,o=!1,l=0,c=e.length;c>l;++l){var u=e[l];if(u.ignoreCase)o=!0;else if(/[a-z]/i.test(u.source.replace(/\\u[\da-f]{4}|\\x[\da-f]{2}|\\[^UXux]/gi,""))){r=!0,o=!1;break}}for(var d={b:8,t:9,n:10,v:11,f:12,r:13},h=[],l=0,c=e.length;c>l;++l){if(u=e[l],u.global||u.multiline)throw Error(""+u);h.push("(?:"+a(u)+")")}return RegExp(h.join("|"),o?"gi":"g")}function t(e){function t(e){switch(e.nodeType){case 1:if(n.test(e.className))break;for(var i=e.firstChild;i;i=i.nextSibling)t(i);i=e.nodeName,("BR"===i||"LI"===i)&&(a[o]="\n",r[o<<1]=s++,r[o++<<1|1]=e);break;case 3:case 4:i=e.nodeValue,i.length&&(i=l?i.replace(/\r\n?/g,"\n"):i.replace(/[\t\n\r ]+/g," "),a[o]=i,r[o<<1]=s,s+=i.length,r[o++<<1|1]=e)}}var i,n=/(?:^|\s)nocode(?:\s|$)/,a=[],s=0,r=[],o=0;e.currentStyle?i=e.currentStyle.whiteSpace:window.getComputedStyle&&(i=document.defaultView.getComputedStyle(e,q).getPropertyValue("white-space"));var l=i&&"pre"===i.substring(0,3);return t(e),{a:a.join("").replace(/\n$/,""),c:r}}function i(e,t,i,n){t&&(e={a:t,d:e},i(e),n.push.apply(n,e.e))}function n(t,n){function a(e){for(var t=e.d,c=[t,"pln"],u=0,d=e.a.match(s)||[],h={},p=0,f=d.length;f>p;++p){var m,g=d[p],_=h[g],v=void 0;if("string"==typeof _)m=!1;else{var y=r[g.charAt(0)];if(y)v=g.match(y[1]),_=y[0];else{for(m=0;l>m;++m)if(y=n[m],v=g.match(y[1])){_=y[0];break}v||(_="pln")}!(m=_.length>=5&&"lang-"===_.substring(0,5))||v&&"string"==typeof v[1]||(m=!1,_="src"),m||(h[g]=_)}if(y=u,u+=g.length,m){m=v[1];var b=g.indexOf(m),w=b+m.length;v[2]&&(w=g.length-v[2].length,b=w-m.length),_=_.substring(5),i(t+y,g.substring(0,b),a,c),i(t+y+b,m,o(_,m),c),i(t+y+w,g.substring(w),a,c)}else c.push(t+y,_)}e.e=c}var s,r={};!function(){for(var i=t.concat(n),a=[],o={},l=0,c=i.length;c>l;++l){var u=i[l],d=u[3];if(d)for(var h=d.length;--h>=0;)r[d.charAt(h)]=u;u=u[1],d=""+u,o.hasOwnProperty(d)||(a.push(u),o[d]=q)}a.push(/[\S\s]/),s=e(a)}();var l=n.length;return a}function a(e){var t=[],i=[];t.push(e.tripleQuotedStrings?["str",/^(?:'''(?:[^'\\]|\\[\S\s]|''?(?=[^']))*(?:'''|$)|"""(?:[^"\\]|\\[\S\s]|""?(?=[^"]))*(?:"""|$)|'(?:[^'\\]|\\[\S\s])*(?:'|$)|"(?:[^"\\]|\\[\S\s])*(?:"|$))/,q,"'\""]:e.multiLineStrings?["str",/^(?:'(?:[^'\\]|\\[\S\s])*(?:'|$)|"(?:[^"\\]|\\[\S\s])*(?:"|$)|`(?:[^\\`]|\\[\S\s])*(?:`|$))/,q,"'\"`"]:["str",/^(?:'(?:[^\n\r'\\]|\\.)*(?:'|$)|"(?:[^\n\r"\\]|\\.)*(?:"|$))/,q,"\"'"]),e.verbatimStrings&&i.push(["str",/^@"(?:[^"]|"")*(?:"|$)/,q]);var a=e.hashComments;return a&&(e.cStyleComments?(t.push(a>1?["com",/^#(?:##(?:[^#]|#(?!##))*(?:###|$)|.*)/,q,"#"]:["com",/^#(?:(?:define|elif|else|endif|error|ifdef|include|ifndef|line|pragma|undef|warning)\b|[^\n\r]*)/,q,"#"]),i.push(["str",/^<(?:(?:(?:\.\.\/)*|\/?)(?:[\w-]+(?:\/[\w-]+)+)?[\w-]+\.h|[a-z]\w*)>/,q])):t.push(["com",/^#[^\n\r]*/,q,"#"])),e.cStyleComments&&(i.push(["com",/^\/\/[^\n\r]*/,q]),i.push(["com",/^\/\*[\S\s]*?(?:\*\/|$)/,q])),e.regexLiterals&&i.push(["lang-regex",/^(?:^^\.?|[!+-]|!=|!==|#|%|%=|&|&&|&&=|&=|\(|\*|\*=|\+=|,|-=|->|\/|\/=|:|::|;|<|<<|<<=|<=|=|==|===|>|>=|>>|>>=|>>>|>>>=|[?@[^]|\^=|\^\^|\^\^=|{|\||\|=|\|\||\|\|=|~|break|case|continue|delete|do|else|finally|instanceof|return|throw|try|typeof)\s*(\/(?=[^*/])(?:[^/[\\]|\\[\S\s]|\[(?:[^\\\]]|\\[\S\s])*(?:]|$))+\/)/]),(a=e.types)&&i.push(["typ",a]),e=(""+e.keywords).replace(/^ | $/g,""),e.length&&i.push(["kwd",RegExp("^(?:"+e.replace(/[\s,]+/g,"|")+")\\b"),q]),t.push(["pln",/^\s+/,q," \r\n	\xa0"]),i.push(["lit",/^@[$_a-z][\w$@]*/i,q],["typ",/^(?:[@_]?[A-Z]+[a-z][\w$@]*|\w+_t\b)/,q],["pln",/^[$_a-z][\w$@]*/i,q],["lit",/^(?:0x[\da-f]+|(?:\d(?:_\d+)*\d*(?:\.\d*)?|\.\d\+)(?:e[+-]?\d+)?)[a-z]*/i,q,"0123456789"],["pln",/^\\[\S\s]?/,q],["pun",/^.[^\s\w"-$'./@\\`]*/,q]),n(t,i)}function s(e,t){function i(e){switch(e.nodeType){case 1:if(s.test(e.className))break;if("BR"===e.nodeName)n(e),e.parentNode&&e.parentNode.removeChild(e);else for(e=e.firstChild;e;e=e.nextSibling)i(e);break;case 3:case 4:if(l){var t=e.nodeValue,a=t.match(r);if(a){var c=t.substring(0,a.index);e.nodeValue=c,(t=t.substring(a.index+a[0].length))&&e.parentNode.insertBefore(o.createTextNode(t),e.nextSibling),n(e),c||e.parentNode.removeChild(e)}}}}function n(e){function t(e,i){var n=i?e.cloneNode(!1):e,a=e.parentNode;if(a){var a=t(a,1),s=e.nextSibling;a.appendChild(n);for(var r=s;r;r=s)s=r.nextSibling,a.appendChild(r)}return n}for(;!e.nextSibling;)if(e=e.parentNode,!e)return;for(var i,e=t(e.nextSibling,0);(i=e.parentNode)&&1===i.nodeType;)e=i;c.push(e)}var a,s=/(?:^|\s)nocode(?:\s|$)/,r=/\r\n?|\n/,o=e.ownerDocument;e.currentStyle?a=e.currentStyle.whiteSpace:window.getComputedStyle&&(a=o.defaultView.getComputedStyle(e,q).getPropertyValue("white-space"));var l=a&&"pre"===a.substring(0,3);for(a=o.createElement("LI");e.firstChild;)a.appendChild(e.firstChild);for(var c=[a],u=0;u<c.length;++u)i(c[u]);t===(0|t)&&c[0].setAttribute("value",t);var d=o.createElement("OL");d.className="linenums";for(var h=Math.max(0,t-1|0)||0,u=0,p=c.length;p>u;++u)a=c[u],a.className="L"+(u+h)%10,a.firstChild||a.appendChild(o.createTextNode("\xa0")),d.appendChild(a);e.appendChild(d)}function r(e,t){for(var i=t.length;--i>=0;){var n=t[i];y.hasOwnProperty(n)?window.console&&console.warn("cannot override language handler %s",n):y[n]=e}}function o(e,t){return e&&y.hasOwnProperty(e)||(e=/^\s*</.test(t)?"default-markup":"default-code"),y[e]}function l(e){var i=e.g;try{var n=t(e.h),a=n.a;e.a=a,e.c=n.c,e.d=0,o(i,a)(e);var s=/\bMSIE\b/.test(navigator.userAgent),i=/\n/g,r=e.a,l=r.length,n=0,c=e.c,u=c.length,a=0,d=e.e,h=d.length,e=0;d[h]=l;var p,f;for(f=p=0;h>f;)d[f]!==d[f+2]?(d[p++]=d[f++],d[p++]=d[f++]):f+=2;for(h=p,f=p=0;h>f;){for(var m=d[f],g=d[f+1],_=f+2;h>=_+2&&d[_+1]===g;)_+=2;d[p++]=m,d[p++]=g,f=_}for(d.length=p;u>a;){var v,y=c[a+2]||l,b=d[e+2]||l,_=Math.min(y,b),w=c[a+1];if(1!==w.nodeType&&(v=r.substring(n,_))){s&&(v=v.replace(i,"\r")),w.nodeValue=v;var k=w.ownerDocument,x=k.createElement("SPAN");x.className=d[e+1];var $=w.parentNode;$.replaceChild(x,w),x.appendChild(w),y>n&&(c[a+1]=w=k.createTextNode(r.substring(_,y)),$.insertBefore(w,x.nextSibling))}n=_,n>=y&&(a+=2),n>=b&&(e+=2)}}catch(D){"console"in window&&console.log(D&&D.stack?D.stack:D)}}var c=["break,continue,do,else,for,if,return,while"],u=[[c,"auto,case,char,const,default,double,enum,extern,float,goto,int,long,register,short,signed,sizeof,static,struct,switch,typedef,union,unsigned,void,volatile"],"catch,class,delete,false,import,new,operator,private,protected,public,this,throw,true,try,typeof"],d=[u,"alignof,align_union,asm,axiom,bool,concept,concept_map,const_cast,constexpr,decltype,dynamic_cast,explicit,export,friend,inline,late_check,mutable,namespace,nullptr,reinterpret_cast,static_assert,static_cast,template,typeid,typename,using,virtual,where"],h=[u,"abstract,boolean,byte,extends,final,finally,implements,import,instanceof,null,native,package,strictfp,super,synchronized,throws,transient"],p=[h,"as,base,by,checked,decimal,delegate,descending,dynamic,event,fixed,foreach,from,group,implicit,in,interface,internal,into,is,lock,object,out,override,orderby,params,partial,readonly,ref,sbyte,sealed,stackalloc,string,select,uint,ulong,unchecked,unsafe,ushort,var"],u=[u,"debugger,eval,export,function,get,null,set,undefined,var,with,Infinity,NaN"],f=[c,"and,as,assert,class,def,del,elif,except,exec,finally,from,global,import,in,is,lambda,nonlocal,not,or,pass,print,raise,try,with,yield,False,True,None"],m=[c,"alias,and,begin,case,class,def,defined,elsif,end,ensure,false,in,module,next,nil,not,or,redo,rescue,retry,self,super,then,true,undef,unless,until,when,yield,BEGIN,END"],c=[c,"case,done,elif,esac,eval,fi,function,in,local,set,then,until"],g=/^(DIR|FILE|vector|(de|priority_)?queue|list|stack|(const_)?iterator|(multi)?(set|map)|bitset|u?(int|float)\d*)/,_=/\S/,v=a({keywords:[d,p,u,"caller,delete,die,do,dump,elsif,eval,exit,foreach,for,goto,if,import,last,local,my,next,no,our,print,package,redo,require,sub,undef,unless,until,use,wantarray,while,BEGIN,END"+f,m,c],hashComments:!0,cStyleComments:!0,multiLineStrings:!0,regexLiterals:!0}),y={};r(v,["default-code"]),r(n([],[["pln",/^[^<?]+/],["dec",/^<!\w[^>]*(?:>|$)/],["com",/^<\!--[\S\s]*?(?:--\>|$)/],["lang-",/^<\?([\S\s]+?)(?:\?>|$)/],["lang-",/^<%([\S\s]+?)(?:%>|$)/],["pun",/^(?:<[%?]|[%?]>)/],["lang-",/^<xmp\b[^>]*>([\S\s]+?)<\/xmp\b[^>]*>/i],["lang-js",/^<script\b[^>]*>([\S\s]*?)(<\/script\b[^>]*>)/i],["lang-css",/^<style\b[^>]*>([\S\s]*?)(<\/style\b[^>]*>)/i],["lang-in.tag",/^(<\/?[a-z][^<>]*>)/i]]),["default-markup","htm","html","mxml","xhtml","xml","xsl"]),r(n([["pln",/^\s+/,q," 	\r\n"],["atv",/^(?:"[^"]*"?|'[^']*'?)/,q,"\"'"]],[["tag",/^^<\/?[a-z](?:[\w-.:]*\w)?|\/?>$/i],["atn",/^(?!style[\s=]|on)[a-z](?:[\w:-]*\w)?/i],["lang-uq.val",/^=\s*([^\s"'>]*(?:[^\s"'/>]|\/(?=\s)))/],["pun",/^[/<->]+/],["lang-js",/^on\w+\s*=\s*"([^"]+)"/i],["lang-js",/^on\w+\s*=\s*'([^']+)'/i],["lang-js",/^on\w+\s*=\s*([^\s"'>]+)/i],["lang-css",/^style\s*=\s*"([^"]+)"/i],["lang-css",/^style\s*=\s*'([^']+)'/i],["lang-css",/^style\s*=\s*([^\s"'>]+)/i]]),["in.tag"]),r(n([],[["atv",/^[\S\s]+/]]),["uq.val"]),r(a({keywords:d,hashComments:!0,cStyleComments:!0,types:g}),["c","cc","cpp","cxx","cyc","m"]),r(a({keywords:"null,true,false"}),["json"]),r(a({keywords:p,hashComments:!0,cStyleComments:!0,verbatimStrings:!0,types:g}),["cs"]),r(a({keywords:h,cStyleComments:!0}),["java"]),r(a({keywords:c,hashComments:!0,multiLineStrings:!0}),["bsh","csh","sh"]),r(a({keywords:f,hashComments:!0,multiLineStrings:!0,tripleQuotedStrings:!0}),["cv","py"]),r(a({keywords:"caller,delete,die,do,dump,elsif,eval,exit,foreach,for,goto,if,import,last,local,my,next,no,our,print,package,redo,require,sub,undef,unless,until,use,wantarray,while,BEGIN,END",hashComments:!0,multiLineStrings:!0,regexLiterals:!0}),["perl","pl","pm"]),r(a({keywords:m,hashComments:!0,multiLineStrings:!0,regexLiterals:!0}),["rb"]),r(a({keywords:u,cStyleComments:!0,regexLiterals:!0}),["js"]),r(a({keywords:"all,and,by,catch,class,else,extends,false,finally,for,if,in,is,isnt,loop,new,no,not,null,of,off,on,or,return,super,then,true,try,unless,until,when,while,yes",hashComments:3,cStyleComments:!0,multilineStrings:!0,tripleQuotedStrings:!0,regexLiterals:!0}),["coffee"]),r(n([],[["str",/^[\S\s]+/]]),["regex"]),window.prettyPrintOne=function(e,t,i){var n=document.createElement("PRE");return n.innerHTML=e,i&&s(n,i),l({g:t,i:i,h:n}),n.innerHTML},window.prettyPrint=function(e){function t(){for(var i=window.PR_SHOULD_USE_CONTINUATION?c.now()+250:1/0;d<n.length&&c.now()<i;d++){var a=n[d],r=a.className;if(r.indexOf("prettyprint")>=0){var o,p,r=r.match(h);if(p=!r){p=a;for(var f=void 0,m=p.firstChild;m;m=m.nextSibling)var g=m.nodeType,f=1===g?f?p:m:3===g&&_.test(m.nodeValue)?p:f;p=(o=f===p?void 0:f)&&"CODE"===o.tagName}for(p&&(r=o.className.match(h)),r&&(r=r[1]),p=!1,f=a.parentNode;f;f=f.parentNode)if(("pre"===f.tagName||"code"===f.tagName||"xmp"===f.tagName)&&f.className&&f.className.indexOf("prettyprint")>=0){p=!0;break}p||((p=(p=a.className.match(/\blinenums\b(?::(\d+))?/))?p[1]&&p[1].length?+p[1]:!0:!1)&&s(a,p),u={g:r,h:a,i:p},l(u))}}d<n.length?setTimeout(t,250):e&&e()}for(var i=[document.getElementsByTagName("pre"),document.getElementsByTagName("code"),document.getElementsByTagName("xmp")],n=[],a=0;a<i.length;++a)for(var r=0,o=i[a].length;o>r;++r)n.push(i[a][r]);var i=q,c=Date;c.now||(c={now:function(){return+new Date}});var u,d=0,h=/\blang(?:uage)?-([\w.]+)(?!\S)/;t()},window.PR={createSimpleLexer:n,registerLangHandler:r,sourceDecorator:a,PR_ATTRIB_NAME:"atn",PR_ATTRIB_VALUE:"atv",PR_COMMENT:"com",PR_DECLARATION:"dec",PR_KEYWORD:"kwd",PR_LITERAL:"lit",PR_NOCODE:"nocode",PR_PLAIN:"pln",PR_PUNCTUATION:"pun",PR_SOURCE:"src",PR_STRING:"str",PR_TAG:"tag",PR_TYPE:"typ"}}(),!function(e){e(function(){window.prettyPrint&&prettyPrint()})}(window.jQuery),$(document).on("page:load ready",function(){$(".response").click(function(){var e=$(this).data("response_type");$(".response").removeClass("active"),$(".response-"+e).addClass("active"),$(".format").hide(),$(".format-"+e).show()})});var alerts={showBanners:function(e){var t=document.getElementById(e);"none"===t.style.display&&(t.style.display="block")},hideBanners:function(e){var t=document.getElementById(e);"block"===t.style.display&&(t.style.display="none")},displayErrorAlert:function(e){alerts.showBanners(e)}},analysis_visualization_name_save={onmouseclick:function(e,t){$(e).val().trim()?($(e).val(xssEvasion.sanitizeResponse($(e).val().trim())),saveType="mouseClick",e.form.save.click()):alerts.displayErrorAlert(t)},onkeypress:function(e,t){13==event.keyCode&&(event.preventDefault(),$(e).val().trim()?($(e).val(xssEvasion.sanitizeResponse($(e).val().trim())),saveType="enter",e.form.save.click()):alerts.displayErrorAlert(t))}};$("#analysis_name_empty_error_close").on("click",function(){alerts.hideBanners(this.parentElement.id)}),$("#matlab_code_empty_warning_close").on("click",function(){alerts.hideBanners(this.parentElement.id)});var evalContainer,fevalContainer,evalDiv,fevalDiv,fevalImg,hiddenMcode,hiddenErrorTitle,hiddenTimeoutTitle,hiddenSuccessTitle,hiddenErrorMessage,unsavedChangesMessage,errored,erroredMessage,timeOutDetailText,codeEditor,mssInit=function(){evalContainer=$("#eval_container .collapse"),fevalContainer=$("#feval_container .collapse"),evalDiv=$("#eval"),fevalDiv=$("#feval_svg"),fevalImg=$("#feval_png"),hiddenMcode=getHiddenMcodeDiv(),hiddenErrorTitle=$("#error_title").val(),hiddenTimeoutTitle=$("#timeout_title").val(),timeOutDetailText=$("#timeout_detailed").val(),hiddenSuccessTitle=$("#success_title").val(),hiddenErrorMessage=$("#error_message").val(),unsavedChangesMessage=$("#unsaved_changes").val(),errored=$("#errored"),erroredMessage=$("#errored_timecontrol_react").val(),""!==hiddenErrorMessage&&displayError(hiddenErrorMessage),$("#clear").click(function(){clearHistory(),clearFEvalResponse()}),$(window).unbind("beforeunload.matlab").bind("beforeunload.matlab",function(){return matlabEditor.rtcPresent()&&unsavedChanges()?unsavedChangesMessage:void 0}),$(document).unbind("page:before-change.matlab").bind("page:before-change.matlab",function(){return matlabEditor.rtcPresent()&&unsavedChanges()&&!confirm(unsavedChangesMessage)?!1:void 0})},onEditorLoad=function(){$("#editorSpinner").hide(),codeEditor=window.editor.rtcInstance.getDocument(),matlabEditor.checkCodeChange(),mssInit(),matlabEditor.setMcode(),$("#commit").click(function(){matlabEditor.uiLock(),$(".dismiss").click(),hiddenMcode.val(matlabEditor.getMcode())}),$("#save").click(function(){"enter"!=saveType&&"mouseClick"!=saveType&&matlabEditor.uiLock(),$(".dismiss").click(),hiddenMcode.val(matlabEditor.getMcode())}),$("#analytics_text_field").length>0&&matlabEditor.checkMatlabFileNameChange()},isPlugin=function(){return elementPresent(fevalContainer)},isMatlabIotAnalytic=function(){return elementPresent($("#matlab_iot_analytic_mcode"))},getHiddenMcodeDiv=function(){var e;return e=isMatlabIotAnalytic()?"#matlab_iot_analytic_mcode":isPlugin()?"#plugin_mcode":"#matlab_code_mcode",$(e)},elementPresent=function(e){return"string"==typeof e?0!==$(e).length:0!==e.length},unsavedChanges=function(){return matlabEditor.getMcode()!==hiddenMcode.val()},clearFEvalResponse=function(){elementPresent(fevalDiv)&&fevalDiv.children().remove(),elementPresent(fevalImg)&&(fevalImg.removeAttr("src"),fevalImg.hide())},clearHistory=function(){elementPresent(evalDiv)&&evalDiv.children().remove()},handleMSSResponse=function(e){if("error"in e&&null!==e.error)displayError(e.error),clearFEvalResponse();else if(displaySuccess(hiddenSuccessTitle),elementPresent(evalDiv)&&"eval"in e&&appendOutput(e.eval,!1),elementPresent(fevalDiv)&&"feval"in e){var t=e.feval;clearFEvalResponse(),"ggjson"in t&&null!==t.ggjson?handleWebPlotResponse(t.ggjson):"hgplot"in t&&null!==t.hgplot&&handlePlotResponse(t.hgplot)}},handleMSSResponseIotAnalytics=function(e){if($("#eval_container").show(),"error"in e&&null!==e.error)displayError(e.error),clearFEvalResponse();else if(displaySuccess(hiddenSuccessTitle),elementPresent(evalDiv)&&"eval"in e&&appendOutput(e.eval,!1),"feval"in e){var t=e.feval;clearFEvalResponse(),"ggjson"in t&&null!==t.ggjson?($("#feval_container").show(),handleWebPlotResponse(t.ggjson)):"hgplot"in t&&null!==t.hgplot?($("#feval_container").show(),handlePlotResponse(t.hgplot)):$("#feval_container").hide()}},handlePlotResponse=function(e){fevalImg.attr("src",e).show()},handleWebPlotResponse=function(e){var t=JSON.parse(e);renderVega(t,"#feval_svg"),fevalImg.hide()},appendOutput=function(e,t){if(""!==e&&null!==e&&void 0!==e){var i=document.createElement("div");t===!0&&$(i).addClass("matlab_warning");var n=xssEvasion.sanitizeResponse(e);if(i.innerHTML=n,elementPresent(evalDiv)){var a=$(i).find("a");a.length>0&&$(a).click(interceptErrorUrl),$(document.createElement("hr")).appendTo(i),$(i).appendTo(evalDiv),$(evalDiv).scrollTop($(evalDiv).prop("scrollHeight"))}}},displayError=function(e,t){void 0===t&&(t="#root");var i=hiddenErrorTitle;"true"===errored.val()&&(i+=" "+erroredMessage),e===timeOutDetailText&&(i=hiddenTimeoutTitle),$('<div class="flash alert alert-danger"><span class="dismiss">X</span><p>'+i+"</p></div").insertBefore(t),$(".flash a").click(interceptErrorUrl),$(".dismiss").on("click",function(){$(this).parent().remove()}),appendOutput(e,!0)},displaySuccess=function(e,t){void 0===t&&(t="#root"),$(".alert-success").remove(),$('<div class="flash alert alert-success"><span class="dismiss">X</span><p>'+e+"</p></div").insertBefore(t),$(".dismiss").on("click",function(){$(this).parent().remove()}),setTimeout(function(){$("div.flash.alert.alert-success").length>0&&$(".flash").hide("slow")},15e3)},displayErrorFormElements=function(e,t){void 0===t&&(t="#root"),$(".alert-danger").remove(),$('<div class="flash alert alert-danger"><span class="dismiss">X</span><p class="word_break_normal" id="error_message_p"> </p></div>').insertBefore(t),$("#error_message_p").append(e),$(".dismiss").on("click",function(){$(this).parent().remove()})},interceptErrorUrl=function(e){"http"!==this.href.substring(0,4)&&(e.preventDefault(),evalErrorUrl(this.href,function(e){null!==e&&"eval"in e&&appendOutput(e.eval,!1)}))},evalErrorUrl=function(e,t){if(-1!==e.indexOf("matlab:")){var i=e.substring(0,7);if("matlab:"===i){var n=e.substring(7);i=n.substring(0,3),"doc"===i?(n=n.substring(4),window.open("http://www.mathworks.com/help/search.html?qdoc="+n)):$.ajax({method:"POST",url:"test_code",data:{mcode:n},dataType:"json"}).done(function(e){t(e)})}}},renderVega=function(e,t){var i=new thingSpeakWebplot;e.resizable=!0,e.resizableButtonVisible=!1,i.setSpec(e,t)!==!1&&(i.loadLibraries(),i.render(),i.resize())},matlabEditor={checkCodeChange:function(){document.getElementById("solutionBodyArea").onkeyup=function(){parent.document.getElementById("saveNeeded")&&(parent.document.getElementById("saveNeeded").innerHTML="*")}},rtcPresent:function(){return"undefined"!=typeof codeEditor},setMcode:function(){matlabEditor.rtcPresent()&&codeEditor.setText(hiddenMcode.val())},getMcode:function(){return matlabEditor.rtcPresent()?codeEditor.getText():void 0},uiUnlock:function(){matlabEditor.rtcPresent()&&(window.editor.rtcInstance.focus(),codeEditor.setReadOnly(!1))},uiLock:function(){matlabEditor.rtcPresent()&&(window.editor.rtcInstance.blur(),window.editor.resizeEditor(),codeEditor.setReadOnly(!0))},checkMatlabFileNameChange:function(){document.getElementById("analytics_text_field").onkeypress=function(){parent.document.getElementById("saveNeeded")&&(parent.document.getElementById("saveNeeded").innerHTML="*")}}},ThingSpeak=function(e){return e}(ThingSpeak||{}),setExhaustionAlertDefaults=function(){is_shutOff=!1,is_leu=!1,exhuastion_message_id="#call_of_action_exhaust",shut_off_message_id="#call_of_action_shutoff",expire_message_id="#call_of_action_expire",to_expire_message_id="#call_of_action_to_expire",$(".exhaustion_reminder").hide(),$(".expiration_reminder").hide(),$(".shutoff_alert").hide(),$(".shutoff_expiration_alert").hide(),currentDate=new Date,a_tag_id=null},checkMessageExhaustion=function(e,t,i,n,a,s){var r=!1;if(estimated_exhaustion_date=UsageVisualizations.estimateExhaustionOrExpirationDate(n.monthly,n.daily,s).Date,t.dateType=UsageVisualizations.estimateExhaustionOrExpirationDate(n.monthly,n.daily,s).DateType,1==is_shutOff)$("#license_id_val").text(e),$("#shut_off_date").text(moment(t.exhaustion_date).format("LL")),$(".shutoff_alert").show(),void 0!=a&&a===!0&&(r=!0);else if(void 0!=t.dateType&&"Expiration Date"===t.dateType&&estimated_exhaustion_date<currentDate)setExpirationAlert(e,i,!0),$("#license_id_val_expire_shutoff").text(e),$("#shut_off_date_exp").text(moment(estimated_exhaustion_date).format("LL")),i||$(".shutoff_expiration_alert").show();else{var o=Math.abs(estimated_exhaustion_date.getTime()-(new Date).getTime()),l=Math.ceil(o/864e5);45>=l&&(r=!0,void 0!=t.dateType&&"Expiration Date"===t.dateType?($("#license_id_val_expire").text(e),$("#expiration_date").text(moment(estimated_exhaustion_date).format("LL")),i||(setExpirationAlert(e,i,!1),$(".expiration_reminder").show())):(setExpirationAlert(e,i,!1),$("#license_id_val_exhaust").text(e),$("#exp_expiration_date").text(moment(estimated_exhaustion_date).format("LL")),$(".exhaustion_reminder").show()))}void 0!=a&&a===!0&&r===!0&&$("#monthly_usage_tab").is(":visible")&&$('#charts_tabs a[href="#monthly_usage"]').tab("show")},populateFreeUnitsLink=function(){1!=is_shutOff?$(exhuastion_message_id).attr("href","/prices"):$(shut_off_message_id).attr("href","/prices")},populateAlertMessages=function(e,t){1==is_leu?setMessageForLEU(t):setMessageForNonLEU(e,t)},setMessageForLEU=function(e){setAdminContactMessage(1!=e?exhuastion_message_id:shut_off_message_id)},setMessageForNonLEU=function(e,t){1!=t?setPurchaseUnitsMessage(exhuastion_message_id,e):setPurchaseUnitsMessage(shut_off_message_id,e)},populatePurchaseUnitsLink=function(e){$("#purchase_units_link").attr("href","/account/purchase/"+encodeURIComponent(e))},setAdminContactMessage=function(e){$(e).text("Contact your administrator.").removeClass("exhaustion_alert").removeAttr("href").addClass("contact_admin")},setPurchaseUnitsMessage=function(e,t){$(e).text("Purchase more units").attr("href","/account/purchase/"+encodeURIComponent(t)).attr("data-no-turbolink",!0)},setExpirationAlert=function(e,t,i){a_tag_id=1==i?expire_message_id:to_expire_message_id,1==t?$(a_tag_id).attr("href","/prices"):1==is_leu?$(a_tag_id).text("Contact your administrator.").removeClass("exhaustion_alert").removeAttr("href").addClass("contact_admin"):$(a_tag_id).text("Purchase more units").attr("href","/account/purchase/"+encodeURIComponent(e)).attr("data-no-turbolink",!0)};ThingSpeak.Channel=function(){function e(e){this.channel=e.channel,this.publicView=e.public_view,this.currentUserOwns=e.current_user_owns,this.windows=[],$("abbr.timeago").timeago();for(var t in e.windows)this.windows.push(ThingSpeak.Window.init(e.windows[t],this.currentUserOwns));if($("#add_widget_modal").on("show.bs.modal",function(){document.getElementById("add_widget_next").disabled=!0,widgetPreview.resetSettings(),widgetPreview.showPreviewPane()}),$("#add_widget_next").click(function(){widgetPreview.showWidgetForm()}.bind(this)),$(".add_widget_cancel").click(function(){widgetPreview.resetSettings()}.bind(this)),$("#configure_widget_parameters_modal").on("shown.bs.modal",function(){widgetPreviewHelpers.gaugeToggleDisplayCheckBox(this)}.bind(this)),$("#configure_widget_parameters_modal").on("hide.bs.modal",function(){$("#gauge_min_max_error").hide(),$("#units_error").hide(),widgetPreview.resetSettings()}),$("#invalid_widget_parameter_close").on("click",function(){$(this).parent().hide()}),$("#invalid_widget_type_close").on("click",function(){$(this).parent().hide()}),$(document).on("click","#gauge_add_range_",function(){widgetHelperFunctions.gaugePlusButtonHelper("widget_params_config_")}),$(document).on("click","[id^=range_close_icon]",function(e){gaugeRemoveRange(e.target.parentElement)}),$(document).on("click","#gauge_min_max_error_close",function(){widgetHelperFunctions.hideGaugeMinMaxError(this)}),$(document).on("click","#units_error_close",function(){widgetHelperFunctions.hideUnitsError(this)}),$("#add_widget_create").click(function(){var e=$(".window-preview-container-selected").find("#widget-metadata-id").html(),t=$("#configure_widget_parameters_modal").find("#gauge_min_max_error"),i=$("#configure_widget_parameters_modal").find("#units_error"),n=widgetHelperFunctions.validateAndGetWidgetData(e,t,i);
if(!n)return!1;var a=this.publicView,s=widgetHelperFunctions.getWidgetWindow(e,n,a);$(this).toggleClass("window-preview-container-selected"),ThingSpeak.Window.addWidgetWindow(this.channel.id,s)}.bind(this)),$("#add_visualization_modal").on("show.bs.modal",function(){hiddenText=$("#add_visualization_empty_text"),$("#add_visualization_modal_content_body").children("div").length>0?hiddenText.attr("hidden","hidden"):hiddenText.removeAttr("hidden")}),$(".window-preview-container").click(function(){widgetPreview.selectCurrentWindow(),$(this).toggleClass("window-preview-container-selected")}),$("#add_visualization_cancel").click(function(){$(".window-preview-container-selected").removeClass("window-preview-container-selected")}),$("#add_visualization_save").click(function(){var e=this.publicView,t=[],i={};$(".window-preview-container-selected").each(function(n,a){$(a).remove(),i={public_flag:e,content_type:$(a).attr("content-type"),content_id:$(a).attr("content-id")},t.push(i)}),ThingSpeak.Window.addVisualizations(this.channel.id,t)}.bind(this)),this.currentUserOwns){var i=function(){var e=[];$(".window-container").each(function(t,i){e.push(i.id.split("_")[1])});var t="/channels/"+this.channel.id+"/windows/reposition",i={public_flag:this.publicView,window_ids:e};$.ajax({url:t,method:"PUT",data:i,dataType:"json"})}.bind(this);this.sortable=Sortable.create($("#windows_container")[0],{sort:!0,delay:0,animation:150,handle:".window-header",draggable:".window-container",scroll:!0,scrollSensitivity:70,scrollSpeed:10,fallbackOnBody:!1,onEnd:i})}return this}var t=function(t){return new e(t)},i=function(e){var t=$.parseHTML(e);$(t).click(function(){$(this).toggleClass("window-preview-container-selected")}),$("#add_visualization_modal_content_body").append(t)};return{init:t,addVisualizationPreview:i}}();var loadMeterData=function(e){var t;$("#available_licenses").change(function(){var e=this.value,t=$("#channel-metadata-id").html();$.ajax({url:"/channels/update_license",method:"POST",data:{channel_id:t,license:e},dataType:"html"})}),t=e.is_free_user?e.free_license_id:e.is_a_staff?e.staff_license_id:$("#available_licenses").val(),loadMeterInfo(t),$("#available_licenses").change(function(){loadMeterInfo($("#available_licenses").val())})},setDefaultsChannels=function(){$("input#upload_csv_channel_btn").removeAttr("disabled")},loadMeterInfo=function(e){setExhaustionAlertDefaults();var t;setDefaultsChannels(),1==meter_data.is_free_user?(1==meter_data.has_exhausted&&(is_shutOff=!0,t="Importing data into a channel requires messages. Buy a new license."),populateFreeUnitsLink()):meter_data.licenses.forEach(function(i){i.license_id==e&&(null!=i.has_exhausted&&(is_shutOff=!0,t="Importing data into a channel requires messages. Purchase more units."),1==i.is_an_leu&&(is_leu=!0,t="Importing data into a channel requires messages. Contact your license administrator."),populatePurchaseUnitsLink(e),populateAlertMessages(e,is_shutOff))}),findDailyAndMonthlyUsage(e),is_shutOff===!0&&($("input#upload_csv_channel_btn").addClass("enable_events_disabled_elements"),$("input#upload_csv_channel_btn").attr("disabled","disabled"),$("input#upload_csv_channel_btn").attr("title",t))},monthlyData,dailyData,findDailyAndMonthlyUsage=function(e){var t=!1,i={daily:void 0,monthly:void 0},n={userType:meter_data.user_type},a=0;meter_data.is_free_user||jQuery.isEmptyObject(meter_data.licenses)||meter_data.licenses.forEach(function(i){i.license_id==e&&(t=i.is_an_leu,a=i.total_remaining_messages_per_license)}),meter_data.is_free_user?(n.number_of_messages_per_unit=meter_data.free_messages_per_year,n.messages_remaining=meter_data.licenses[0].messages_remaining):(n.number_of_messages_per_unit=meter_data.messages_per_paid_unit,n.messages_remaining=a);var s=function(e){i.daily=e,o(i)},r=function(e){i.monthly=e,o(i)},o=function(t){t.daily&&t.monthly&&checkMessageExhaustion(e,meter_data,meter_data.is_free_user,i,!1,n)},l=5e3;$.ajax({url:"/account/daily_usage.json",cache:!1,data:{lid:e,is_an_leu:t},dataType:"json",tryCount:0,retryLimit:1,timeout:l}).done(s).fail(function(e){if(200==e.status||304==e.status);else if(this.tryCount++,this.tryCount<=this.retryLimit)return void $.ajax(this)}),$.ajax({url:"/account/monthly_usage.json",cache:!1,data:{lid:e,is_an_leu:t},dataType:"json",tryCount:0,retryLimit:1,timeout:l}).done(r).fail(function(e){if(200==e.status||304==e.status);else if(this.tryCount++,this.tryCount<=this.retryLimit)return void $.ajax(this)})},usagePurposeModal={showHideUsageModal:function(){usage_purpose_modal_flag===!1?usagePurposeModal.setModalFields():$("#usage_purpose_modal").modal("hide")},setModalFields:function(){usagePurposeModal.setModalDefaults(),usagePurposeModal.setModalOptionsForCommGov(),usagePurposeModal.setModalOptionsForNonCommGov()},setModalDefaults:function(){$("#usage_purpose_modal").modal("show"),$("#submit_intent_of_use").attr("disabled","disableClick"),$("#company_name").hide()},setModalOptionsForCommGov:function(){$("#usage_purpose_modal").on("click","#extended_user_detail_intended_use_0, #extended_user_detail_intended_use_1",function(){$("#company_name").show(),usagePurposeModal.toggleOkButton()})},setModalOptionsForNonCommGov:function(){$("#usage_purpose_modal").on("click","#extended_user_detail_intended_use_2, #extended_user_detail_intended_use_3, #extended_user_detail_intended_use_4",function(){$("#company_name").hide(),$("#extended_user_detail_company_name").val(null),$("#submit_intent_of_use").removeAttr("disabled")})},toggleOkButton:function(){""===$.trim($("#extended_user_detail_company_name").val())?$("#submit_intent_of_use").attr("disabled","disableClick"):$("#submit_intent_of_use").removeAttr("disabled")}};$(document).ready(function(){"channels"===location.pathname.substring(1)&&usagePurposeModal.showHideUsageModal()});var widgetPreview={showPreviewPane:function(){$("#add_widget_modal_content_body").children("div").length>0?$("#add_widget_empty_text").attr("hidden",!0):$("#add_widget_empty_text").attr("hidden",!1)},showWidgetForm:function(){var e=$(".window-preview-container-selected").find("#widget-metadata-id").html(),t=$("#channel-metadata-id").html();ThingSpeak.Widget.getNewWidgetFormElements(t,e)},resetSettings:function(){$(".window-preview-container-selected").removeClass("window-preview-container-selected");$("#channel-metadata-id").html()},selectCurrentWindow:function(){$("#add_widget_modal_content_body > .window-preview-container-selected").each(function(e,t){t.classList.remove("window-preview-container-selected")}),document.getElementById("add_widget_next").disabled=!1}},widgetPreviewHelpers={gaugeToggleDisplayCheckBox:function(){$(document).on("click","#display_value_",function(){this.value=$(this).is(":checked")?!0:!1})}},widgetHelperFunctions={validateAndGetWidgetData:function(e,t,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a="#widget_params_config_"+n;switch(Number(e)){case 0:return widgetHelperFunctions.isGaugeValid(a,n,t,i)?ThingSpeak.Widget.getGaugeParams(n):!1;case 1:return widgetHelperFunctions.isNumericDisplayValid(a,n,i)?ThingSpeak.Widget.getNumericDisplayParams(n):!1;case 2:return ThingSpeak.Widget.getLampIndicatorParams(n);default:return!1}},getWidgetWindow:function(e,t,i){var n=$(".window-preview-container-selected")[0],a=($("#channel-metadata-id").html(),{public_flag:i,content_type:$(n).attr("content-type"),content_id:$(n).attr("content-id"),widget_type:e,parameters:t});return a},isGaugeValid:function(e,t,i,n){var a=!0;return widgetHelperFunctions.isGaugeMinMaxInvalid(e,t)&&(a=!1,i.show()),widgetHelperFunctions.isUnitInvalid(e,t)&&(a=!1,n.show()),a},isNumericDisplayValid:function(e,t,i){var n=!0;return widgetHelperFunctions.isUnitInvalid(e,t)&&(n=!1,i.show()),n},updateName:function(e,t){t=void 0!=t?t:"";var i=$(e).find("#name_"+t)[0].value,t="#window_"+t,n=" .window-title",a=t+n;$(a).html(i)},isGaugeMinMaxInvalid:function(e,t){t=void 0!=t?t:"";var i=$(e).find("#min_"+t)[0].value,n=$(e).find("#max_"+t)[0].value;return widgetHelperFunctions.isMaxMinInvalid(i,n)},isMaxMinInvalid:function(e,t){return Number(e)>=Number(t)?!0:!1},isUnitInvalid:function(e,t){var i=$(e).find("#units_"+t)[0].value;return""===i||/([^0-9])$/.test(i)?!1:!0},hideGaugeMinMaxError:function(e){var t=$("#"+$(e).parents()[4].id).find("#gauge_min_max_error");t.hide()},hideUnitsError:function(e){var t=$("#"+$(e).parents()[4].id).find("#units_error");t.hide()},gaugePlusButtonHelper:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=$("#range_meta_key_"+t).html(),n=Math.floor(9e5*Math.random())+1e5,a=Number(document.getElementById("range_meta_key_"+t).innerHTML);rangeLabel=0===a?"Range":"";var s="<tr><td class='widget-form-label widget-table-cells'><label class='control-label'>"+rangeLabel+" </label></td><td class='widget-table-cells'><input class='form-control' type='number' step='any' name='range_start_"+i+"' value='0'></td><td class='widget-table-cells'><input class='form-control' type='number' step='any' name='range_end_"+i+"' value='0'></td><td class='widget-table-cells'><input class='form-control' value=#"+n+" name='range_color_"+i+"' type='color'></input></td><td name='"+t+"' class='color-range-row'><span id ='range_close_icon_"+i+"'class='close' aria-hidden='true'>&times;</span></td></tr>";document.getElementById(e).insertAdjacentHTML("beforeend",s),""!=document.getElementById("range_meta_key_"+t)&&(document.getElementById("range_meta_key_"+t).innerHTML=Number(i)+1)}};ThingSpeak.Window=function(){function e(e,t){return this.initialize=function(e,t){for(var i in e)this[i]=e[i];if(null!==this.html&&$("#windows_container").append($.parseHTML(this.html)),this.container=$("#window_"+this.id),this.iframeModal=$("#window_iframe_modal_"+this.id),this.iframe=$("#window_iframe_"+this.id),t){if(this.optionsModal=$("#window_options_modal_"+this.id),this.options_json=JSON.parse(this.options_json),$(this.container).find("#remove_window_"+this.id).click(this.remove.bind(this)),$("#window_options_modal_save_"+this.id).click(this.update_options.bind(this)),$("#window_widget_options_modal_save_"+this.id).click(this.update_widget_params.bind(this)),$("#widget_options_modal_open_"+this.id).click(this.widget_options_modal_open.bind(this)),$(this.optionsModal).on("hidden.bs.modal",this.reset_options.bind(this)),"widget"==this.content_type){var n=this.id;$("#window_widget_options_modal_"+n).on("shown.bs.modal",function(){$(document).on("click","#display_value_"+n,function(){this.value=$(this).is(":checked")?!0:!1})}.bind(this)),$(document).on("click","#gauge_add_range_"+n,function(){var e="widget_params_config_"+n;widgetHelperFunctions.gaugePlusButtonHelper(e,n)})}$(this.optionsModal).find(".mutuallyexclusive").change(function(e){var t=$(e.target),i=t.attr("id");t.parents("div.modal-body").find(".mutuallyexclusive").each(function(e,t){t.id!==i&&$(t).val("")})}),this.reset_options()}return this},this.widget_options_modal_open=function(){$(".error_banner").hide();var e=this.id,t=this.channel_id,i=this.content_id,n="widget_options_modal_content_body_",a="/channels/"+t+"/widgets/"+i+"/edit.json";$("#"+n).hide(),$.ajax({method:"GET",url:a,success:function(t){$("#"+n).show(),ThingSpeak.Widget.constructConfigModal({params:JSON.parse(t.parameters),enabled_fields:t.enabled_fields},t.widget_type,n,e)},error:function(){$("#"+n).innerHTML="Failed to fetch value from the server."}})},this.update_widget_params=function(){var e=$("#widget_type_metadata_"+this.id).html(),t=$("#window_widget_options_modal_"+this.id).find("#gauge_min_max_error"),i=$("#window_widget_options_modal_"+this.id).find("#units_error"),n=widgetHelperFunctions.validateAndGetWidgetData(e,t,i,this.id);return n?void a.updateWidget(this.id,this.content_id,this.channel_id,n):!1},this.update_options=function(){var e=function(){var e={},t=function(){var t=this.id.split("_")[1],i=$(this).val();""!=i&&(e[t]=i)};return this.optionsModal.find(".form-control").each(t),e}.bind(this),t=function(e){this.iframe_html=e.iframe_html,this.iframe_src=e.iframe_src,this.options=e.options,this.options_json=JSON.parse(e.options_json),$(this.iframe)[0].src=this.iframe_src,$(this.iframeModal).find("pre").text(this.iframe_html),$(this.optionsModal).modal("hide")}.bind(this),i={window_update:"chart_options",options:e()},n=function(e){switch(e.status){case 401:location.href="/login";break;default:location.reload()}};this.post(i,"json",t,n)},this.reset_options=function(){var e=this.options_json,t=function(){var t=this.id.split("_")[1];$(this).val(e[t])};this.optionsModal.find(".form-control").each(t)},this.remove=function(){var e=!0;if("widget"==this.content_type&&(e=confirm("Are you sure you want to delete this widget?")),e){$(this.container).remove();var t={window_update:"remove"};this.post(t,"script")}},this.post=function(e,t,i,n){$.ajax({method:"PUT",url:this.url,data:e,dataType:t}).done(i).error(n)},this.initialize(e,t)}var t=function(t,i){return new e(t,i)},i=function(e,t){data={windows:JSON.stringify(t)},$.ajax({method:"POST",url:"/channels/"+e+"/windows",data:data,dataType:"script"})},n=function(e,t){data={window:t},$.ajax({method:"POST",url:"/channels/"+e+"/windows/create_widget",data:data,dataType:"script",error:function(e){400==e.status&&a.showErrorBanner(e)}})},a={updateWidget:function(e,t,i,n){widgetHelperFunctions.updateName("#widget_params_config_"+e,e);var s="/channels/"+i+"/widgets/"+t,r={paramData:n};$.ajax({method:"PUT",data:r,url:s,success:function(){document.getElementById("window_iframe_"+e).src+=""},error:function(e){400==e.status&&a.showErrorBanner(e)}})},showErrorBanner:function(e){document.getElementById("widget-config-err-msg").innerHTML=JSON.parse(e.responseText).error_message,$("#invalid_widget_parameter").show()}};return{init:t,addVisualizations:i,addWidgetWindow:n}}(),$(document).on("page:load ready",function(){function e(){1==visualization_public_flag?($("#url_checkbox").attr("checked","checked"),s()):($("#url_checkbox").removeAttr("checked"),r())}if(elementPresent($("#channel_ids"))||elementPresent($("#visualization_url_div"))){if(elementPresent($("#results_container"))&&pluginDisplaySettings.hidePlotAndCodeOutput(),elementPresent($("#channel_listings_parent_div"))&&(pluginDisplaySettings.populateShowChannels(),pluginDisplaySettings.toggleFontAwesomePlusSign()),elementPresent($("#channel_ids")))var t=(JSON.parse($("#channel_ids").val()),JSON.parse($("#public_channel_ids").val())),i=$("#visualization_is_private_text").val();var n={displaySharingError:function(){$("#visualization_name_empty_error").show()},displayFlagSaveError:function(){$("#visualization_flag_save_error").show()}},a={setCheckbox:function(){auto_update_matlab_visualization?$("#auto_update_checkbox").attr("checked","checked"):$("#auto_update_checkbox").removeAttr("checked")},savePreference:function(e){var t=auto_update_matlab_visualization_url,i={auto_update_matlab_visualization:e};$.ajax({url:t,method:"PUT",data:i}).fail(function(){alerts.displayErrorAlert("auto_update_matlab_visualization_save_error")})}},s=function(){$("#visualization_URL").prop("placeholder",""),$("#visualization_URL").prop("value",visualization_public_url),document.getElementById("visualization_URL").style.cursor="default",$("#copy_button").show(),$("#visualization_child_div").addClass("input-group")},r=function(){$("#visualization_URL").prop("placeholder",""),$("#visualization_URL").prop("value",""),document.getElementById("visualization_URL").style.cursor="not-allowed",$("#copy_button").hide()};elementPresent($("#visualization_url_div"))&&e(),elementPresent($("#visualization_auto_update"))&&(a.setCheckbox(),$("#auto_update_checkbox").click(function(){a.savePreference(this.checked)})),$("#auto_update_matlab_visualization_save_error_close").on("click",function(){alerts.hideBanners(this.parentElement.id)}),$("#visualization_text_field").on("change",function(){$(this).val().trim()?(saveType="mouseClick",this.form.save.click()):n.displaySharingError()}),$("#visualization_text_field").on("keypress",function(e){13==e.keyCode&&(e.preventDefault(),$(this).val().trim()?(saveType="enter",this.form.save.click()):n.displaySharingError())}),$("#url_checkbox").on("click",function(){if(this.checked){if(visualization_public_flag=!0,elementPresent($("#channel_ids")))for(var e=0;e<t.length;e++)$("#public_"+t[e]).attr("disabled",!1).removeAttr("title")}else if(visualization_public_flag=!1,elementPresent($("#channel_ids")))for(var e=0;e<t.length;e++)$("#public_"+t[e]).attr("checked",!1).attr("title",i).attr("disabled",!0);o(!visualization_public_flag),l()});var o=function(e){1==e?r():s()},l=function(){var e=save_public_flag_url,t={public_flag:visualization_public_flag};$.ajax({url:e,method:save_public_flag_url_http_verb,data:t}).fail(function(){n.displayFlagSaveError()})};elementPresent($("#channel_ids"))&&($.tablesorter.addParser({id:"checkbox",is:function(){return!1},format:function(e,t,i){return $(i).children().last().is(":checked")?1:0},type:"numeric"}),$("#add_to_channel_table").tablesorter({headers:{2:{sorter:"checkbox"},3:{sorter:"checkbox"}},widgets:["stickyHeaders"],widgetOptions:{stickyHeaders_attachTo:".add-to-channel-table"},initialized:function(e){var t=!1;$(e).find("input[type=checkbox]").each(function(){$(this).bind("change",function(){$(e).trigger("updateCell",[$(this).closest("td")[0],t])})})}}))}});var elementPresent=function(e){return"string"==typeof e?0!==$(e).length:0!==e.length},pluginDisplaySettings={populateShowChannels:function(){$("#channels_list").html(""),selected=!1;for(var e,t=document.getElementById("add_to_channel_table"),i=1;e=t.rows[i];i++){arr=[];for(var n,a=0;n=e.cells[a];a++)arr[a]=2>a?n.innerHTML:n.getElementsByTagName("input")[1].checked;channel_name=arr[0],channel_id=arr[1],private_view_checkbox_val=arr[2],public_view_checkbox_val=arr[3],is_private=private_view_checkbox_val===!0?"private view":"",is_public=""===is_private?public_view_checkbox_val===!0?"public view":"":public_view_checkbox_val===!0?", public view":"",1!=(""===is_private&&""===is_public)&&(selected=!0,$("#channels_list").append("private view"===is_private?'<li class="list-group-item list-group-channels list-group-item-light"><a href="/channels/'+channel_id+'/private_show">'+channel_name+"</a> ("+channel_id+") - "+is_private+is_public+"</li>":'<li class="list-group-item list-group-channels list-group-item-light"><a href="/channels/'+channel_id+'/">'+channel_name+"</a> ("+channel_id+") - "+is_public+"</li>"))}selected||($("#channels_list").html(""),$("#channels_list").append('<li class="list-group-item list-group-channels list-group-item-light"> None </li>'))},toggleFontAwesomePlusSign:function(){$(".collapse").on("show.bs.collapse",function(){$(this).parent().find(".fa").removeClass("fa-plus").addClass("fa-minus")}).on("hide.bs.collapse",function(){$(this).parent().find(".fa").removeClass("fa-minus").addClass("fa-plus")})},hidePlotAndCodeOutput:function(){is_error?($("#feval_container").show(),$("#eval_container").show()):($("#feval_container").hide(),$("#eval_container").hide())}},usageVisualizationCharts=null;UsageVisualizations=function(){function e(e,t){var i=new Date;i=new Date(i.getFullYear(),i.getMonth(),i.getDate());for(var n=0,a=0,s=0;s<e.units.length;s++)if(void 0!==e.units[s].endDate&&new Date(e.units[s].endDate).getTime()+86400>=i.getTime()&&void 0!==e.units[s].qty&&(n+=e.units[s].qty*t,void 0!==e.units[s].usages))for(var r=0;r<e.units[s].usages.length;r++)if(void 0!==e.units[s].usages[r].months)for(var o=0;o<e.units[s].usages[r].months.length;o++)e.units[s].qty>0&&(a+=e.units[s].usages[r].months[o]);var l={};return l[0]=n,l[1]=a,l}function t(t,i){var n={};n[0]="Invalid Date",n[1]="Unknown Monthly Usage";var a=new Date,r=new Date(a.getTime()-30*s);r<new Date("2016-12-05")&&(r=new Date("2016-12-05"));var o=r.getYear()+1900,l=a.getMonth()-1,c=r.getMonth();if(1>l&&(l=12),void 0===t||void 0===t.units)return n;for(var u=0,d=[],h=0,p=0;p<t.units.length;p++)if(void 0!==t.units[p].usages)for(var f=0;f<t.units[p].usages.length;f++)if(void 0!==t.units[p].usages[f].year&&t.units[p].usages[f].year>=o&&void 0!==t.units[p].usages[f].months)for(var m=0;m<t.units[p].usages[f].months.length;m++)if(m>=c&&l>=m){var g=new Date(t.units[p].endDate);t.units[p].qty>0&&g>=r&&(d[h]=[t.units[p].usages[f].year,m],h+=1,u+=t.units[p].usages[f].months[m])}for(var _,v=[],p=0;p<d.length;p++){_=0;for(var f=0;f<v.length;f++)d[p][0]===v[f][0]&&d[p][1]===v[f][1]&&(_=1);0===_&&v.push(d[p])}var y=0;v.length>0&&(y=u/v.length);var b=e(t,i),w=b[0],k=b[1],x=new Date((new Date).getTime()+366*s);return y>0&&(x=new Date((new Date).getTime()+30*s*Math.floor((w-k)/y))),"Invalid Date"===x.toDateString()&&(x=new Date((new Date).getTime()+366*s)),n[0]=x,n[1]=y,n}function i(e,i,n){var a=0,c=3e6,u=0,d=1,h=0;void 0!==n&&void 0!==n.userType&&(a=parseInt(n.userType)),void 0!==n&&void 0!==n.number_of_messages_per_unit&&(c=parseInt(n.number_of_messages_per_unit)),void 0!==n&&void 0!==n.display_recommended_units&&(u=parseInt(n.display_recommended_units)),void 0!==n&&void 0!==n.proposed_num_of_units&&(d=parseInt(n.proposed_num_of_units),h=1),1>d&&(d=1);var p={chart:{renderTo:i,animation:!1,type:"column"},title:{text:null},xAxis:{categories:[]},yAxis:{min:0,title:{text:"Messages remaining"},stackLabels:{enabled:!1,style:{fontWeight:"bold"}}},legend:{align:"right",x:-30,verticalAlign:"top",y:25,floating:!0,backgroundColor:Highcharts.theme&&Highcharts.theme.background2||"white",borderColor:"#CCC",borderWidth:1,shadow:!1,layout:"vertical"},tooltip:{headerFormat:"<b>{point.x}</b><br/>",pointFormat:"{series.name}: {point.y}<br/>Total: {point.stackTotal}"},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!1}}},series:[],credits:{enabled:!1}};if(void 0===e)return p.chart.height=120,p.yAxis.title.text=null,usageVisualizationCharts=new Highcharts.Chart(p),usageVisualizationCharts.showLoading(1===u?"Not enough data has been collected to display monthly data usage or recommend number of units required at current usage rate. A chart will be populated after at least one month of data has been collected.":"Not enough data has been collected to display monthly data usage. A chart with monthly usage information will be populated after at least one month of data has been collected."),d;if(void 0===e.units||0===e.units.length)return p.chart.height=120,p.yAxis.title.text=null,usageVisualizationCharts=new Highcharts.Chart(p),usageVisualizationCharts.showLoading("This license does not appear to have any available ThingSpeak units."),d;var f=0;for(T=0;T<e.units.length;T++)void 0!==e.units[T].endDate&&e.units[T].qty>0&&e.units[T].usages.length>0&&(f+=1);if(0===f)return p.chart.height=120,p.yAxis.title.text=null,usageVisualizationCharts=new Highcharts.Chart(p),usageVisualizationCharts.showLoading(1===u?"Not enough data has been collected to display monthly data usage or recommend number of units required at current usage rate. A chart will be populated after at least one month of data has been collected.":"A chart with monthly usage information will be populated after at least one month of data has been collected."),d;if(h&&u){var m={},g=new Date;m.id=0,m.qty=d;var _=g.getFullYear(),v=g.getMonth()+1,y=g.getDate();10>v&&(v="0"+v),v>11&&(v="01",_+=1),10>y&&(y="0"+y),m.startDate=_+"-"+v+"-"+y;var b=new Date(g.getTime()+365*s),w=b.getFullYear(),k=b.getMonth()+1,x=b.getDate();10>k&&(k="0"+k),k>11&&(k="01",w+=1),10>x&&(x="0"+x),m.endDate=w+"-"+k+"-"+x;var $=[{}];$[0].year=g.getFullYear(),$[0].months=[0,0,0,0,0,0,0,0,0,0,0,0],m.usages=$,e.units.push(m)}for(var D=new Date,C=new Date(e.units[0].endDate),T=0;T<e.units.length;T++)if(void 0!==e.units[T].endDate&&e.units[T].qty>0){var S=new Date(e.units[T].endDate);S>D&&(D=new Date(S.getTime())),C>new Date(e.units[T].startDate)&&(C=new Date(e.units[T].startDate))}var E=t(e,c),P=E[0],I=E[1];("Invalid Date"===P.toDateString()||P>=D)&&(P=D);var M=new Date(Math.max(P.getTime(),D.getTime())+31*s),N=new Date(M-424*s);C>N&&(N=C);for(var A=[],T=0;T<e.units.length;T++)if(e.units[T].qty>0&&new Date(e.units[T].endDate)>=N){var F=[],L=[],O=N,j=0;if(0===e.units[T].usages.length){var H=N.getMonth(),R=N.getFullYear();do L.push(0),O=new Date(R+"-"+o[H][0]+"-"+o[H][1]),H+=1,H>11&&(H=0,R+=1);while(M>O);L.splice(L.length-1);var z=N.getMonth()+1;10>z&&(z="0"+z);var q=N.getDate();10>q&&(q="0"+q),F=[e.units[T].id,e.units[T].qty,e.units[T].startDate,e.units[T].endDate,N.getFullYear()+"-"+z+"-"+q,L,j]}else{var W;for(W=0;W<e.units[T].usages.length&&e.units[T].usages[W].year!==N.getFullYear();W++);var H=N.getMonth(),R=N.getFullYear();do O=new Date(R+"-"+o[H][0]+"-"+o[H][1]),L.push(e.units[T].usages.length>W&&void 0!==e.units[T].usages[W].months&&e.units[T].usages[W].months.length>=H?e.units[T].usages[W].months[H]:0),H+=1,H>11&&(H=0,R+=1,W+=1);while(M>O);L.splice(L.length-1);var B=N.getMonth()+1;10>B&&(B="0"+B);var U=N.getDate();10>U&&(U="0"+U),F=[e.units[T].id,e.units[T].qty,e.units[T].startDate,e.units[T].endDate,N.getFullYear()+"-"+B+"-"+U,L,j]}for(var Y=new Date(e.units[T].startDate),S=new Date(e.units[T].endDate),V=0,K=0;K<e.units[T].usages.length;K++)for(var G=0;G<e.units[T].usages[K].months.length;G++){var Q=G>=Y.getMonth(),X=e.units[T].usages[K].year>=Y.getFullYear(),J=G<N.getMonth(),Z=e.units[T].usages[K].year<=N.getFullYear();Q&&X&&J&&Z&&(V+=e.units[T].usages[K].months[G])}var et=e.units[T].qty*c-V;V===c&&(F[6]=1),F[5][0]=et,A.push(F)}for(var T=0;T<A.length-1;T++)if(new Date(A[T][3])>new Date(A[T+1][3])){var tt=A[T];A[T]=A[T+1],A[T+1]=tt}for(var it=[],nt=[],T=0;T<A.length;T++){var at,W=1,st=0,rt=0,ot=new Date,lt=ot.getMonth()+1;10>lt&&(lt="0"+lt),ot=new Date(ot.getFullYear()+"-"+lt+"-"+o[ot.getMonth()][1]);do{at=new Date(A[T][4]),st=new Date(A[T][4]).getMonth()+W,rt=Math.floor(st/12),st%=12;var ct=st+1;if(10>ct&&(ct="0"+ct),at=new Date(at.getFullYear()+rt+"-"+ct+"-"+o[st][1]),at>=ot)break;A[T][5][W]=A[T][5][W-1]-A[T][5][W],A[T][5][W]<0&&(A[T][5][W]=0),W+=1}while(ot>at&&at<new Date(A[T][3]));nt[T]=A[T].slice(),nt[T][5]=A[T][5].slice();for(var ut=0;l>ut;ut++)nt[T][5][ut]=0;var j=0;st=new Date(nt[T][4]).getMonth()+1;var ct=st;10>ct&&(ct="0"+ct);var dt=new Date(new Date(nt[T][4]).getFullYear()+"-"+ct+"-"+o[st-1][1]);if(new Date(nt[T][3])>new Date&&0===j&&(0===T||it.length>0&&dt>it[0]?(nt[T][5][W]=A[T][5][W-1]-I,nt[T][5][W]<0&&(nt[T][5][W]=0,it[0]=dt,it[1]=0)):nt[T][5][W]=A[T][5][W-1],nt[T][5][W]>0))for(var ut=W+1;l-1>ut;ut++){rt=0,st=new Date(nt[T][4]).getMonth()+ut,rt=Math.floor(st/12),st%=12,ct=st+1,10>ct&&(ct="0"+ct),dt=new Date(new Date(nt[T][4]).getFullYear()+rt+"-"+ct+"-"+o[st][1]);var ht=new Date(nt[T][3]),pt=ht.getMonth()+1;10>pt&&(pt="0"+pt);var ft=ht.getUTCDate();if(10>ft&&(ft="0"+ft),ht=new Date(ht.getFullYear()+"-"+pt+"-"+ft),dt.getMonth()>ht.getMonth()&&dt.getFullYear()>=ht.getFullYear()){it[0]=new Date(dt.getTime()),it[1]=nt[T][5][ut-1]>I?0:nt[T][5][ut-1]-I;break}if(nt[T][5][ut]=0===T||it.length>0&&dt>=it[0]?nt[T][5][ut-1]-I:nt[T][5][ut-1],nt[T][5][ut]<0&&(nt[T][5][ut]=0,0===j)){it[0]=new Date(dt.getTime()),it[1]=-nt[T][5][ut],j=1;break}}}for(var T=0;T<A.length-1;T++)if(new Date(A[T][3])>new Date(A[T+1][3])){var tt=A[T];A[T]=A[T+1],A[T+1]=tt;var mt=nt[T];nt[T]=nt[T+1],nt[T+1]=mt}var gt=0;do{gt=0;for(var T=0;T<A.length;T++)1===A[T][6]&&(A.splice(T,1),nt.splice(T,1),gt=1)}while(1===gt);for(var T=0;T<A.length;T++){var _t=[];N=new Date(A[T][4]);for(var W=0;l>W;W++){var vt=N.getFullYear(),yt=N.getMonth()+W;vt+=Math.floor(yt/12),yt%=12,_t.push([new Date(vt+"-"+o[yt][0][0]+"-"+o[yt][0][1]),A[T][5][W]])}var bt={};bt.name=3==a?"Remaining messages (purchase "+A[T][2]+")":"Remaining messages (free messages start date "+A[T][2]+")",bt.data=_t,bt.color="rgba("+r[T%r.length][0]+","+r[T%r.length][1]+","+r[T%r.length][2]+",1)",p.series.push(bt)}for(var T=0;T<nt.length;T++){_t=[],N=new Date(nt[T][4]);for(var W=0;l>W;W++)vt=N.getFullYear(),yt=N.getMonth()+W,vt+=Math.floor(yt,12),yt%=12,_t.push([new Date(vt+"-"+o[yt][0][0]+"-"+o[yt][0][1]),nt[T][5][W]]);var wt={};wt.name=3==a?"Projected# messages remaining (purchase "+nt[T][2]+")":"Projected# messages remaining (free messages renewal date "+nt[T][2]+")",wt.data=_t,wt.color="rgba("+r[T%r.length][0]+","+r[T%r.length][1]+","+r[T%r.length][2]+",0.25)",p.series.push(wt)}for(var kt=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],xt=new Date(N),$t=xt.getMonth(),Dt=xt.getFullYear(),Ct=0;l>Ct;)p.xAxis.categories.push(kt[$t]+" "+Dt),$t++,$t>11&&($t=0,Dt+=1),Ct++;return p.series.reverse(),usageVisualizationCharts=new Highcharts.Chart(p),h&&u&&e.units.pop(),d}function n(e,t,i,n){var a=0,r=3e6,o=0,l=0,u=0;void 0!==i&&void 0!==i.userType&&(a=parseInt(i.userType)),void 0!==i&&void 0!==i.number_of_messages_per_unit&&(r=parseInt(i.number_of_messages_per_unit)),void 0!==i&&void 0!==i.display_recommended_units&&(o=parseInt(i.display_recommended_units)),void 0!==i&&void 0!==i.proposed_num_of_units&&(l=parseInt(i.proposed_num_of_units),u=1),n=void 0!==n?parseInt(n):1/0;var d={chart:{renderTo:t,animation:!1},title:{text:null},xAxis:{type:"datetime",labels:{rotation:-45},dateTimeLabelFormats:{day:"%e-%b-%Y"},title:{text:null}},yAxis:{min:0,title:{text:"Messages used per day"},stackLabels:{enabled:!1,style:{fontWeight:"bold",color:Highcharts.theme&&Highcharts.theme.textColor||"gray"}}},legend:{align:"right",x:-30,verticalAlign:"top",y:25,floating:!0,backgroundColor:Highcharts.theme&&Highcharts.theme.background2||"white",borderColor:"#CCC",borderWidth:1,shadow:!1,layout:"vertical",enabled:!0},tooltip:{formatter:function(){return messageText=1!==this.y?"messages":"message","<b>"+this.y+" "+messageText+"</b> used on "+Highcharts.dateFormat("%e-%b-%Y",new Date(this.x))}},plotOptions:{column:{stacking:"normal",events:{legendItemClick:function(){return!1}},showInLegend:!1,dataLabels:{enabled:!1,color:Highcharts.theme&&Highcharts.theme.dataLabelsColor||"white",style:{textShadow:"0 0 3px black"}}}},series:[{name:"Daily ThingSpeak message usage",data:[],marker:{enabled:!1},enableMouseTracking:!0,type:"column",color:"rgba(6,154,71,1)"}],credits:{enabled:!1}},h=[],p=new Date;p=new Date(p.getFullYear(),p.getMonth(),p.getDate(),0,-1*p.getTimezoneOffset());var f=new Date(p-c*s);if(void 0===e||void 0===e.startDate||void 0===e.datapoints||0===e.datapoints)return d.chart.height=120,d.yAxis.title.text=null,d.xAxis.lineWidth=0,usageVisualizationCharts=new Highcharts.Chart(d),void usageVisualizationCharts.showLoading("Not enough data has been collected to display daily data usage. A chart with daily usage information will be populated after at least one day of data has been collected.");for(var m=new Date(e.startDate).getTime(),g=Math.round((f-m)/s),_=Math.max(0,g),v=0,y=_;y<e.datapoints;y++){var b=new Date(f.valueOf()+(y-g)*s);h[y-_]=[b.getTime(),e.usages[y]],parseInt(e.usages[y])>v&&(v=e.usages[y])}if(0===h.length&&(h[0]=[f.getTime(),0]),h.length<c)for(y=h.length;c>y;y++)b=new Date(h[y-1][0]+1*s),h[y]=[b.getTime(),0];d.series[0].data=h,usageVisualizationCharts=new Highcharts.Chart(d),v>.95*n&&(usageVisualizationCharts.addSeries({name:"Recommended maximum daily usage based on your annual capacity",data:[[f.getTime(),n],[p.getTime(),n]],marker:{enabled:!1},enableMouseTracking:!1,type:"line",color:"rgba(0,0,0,0.7)",dashStyle:"shortdot",events:{legendItemClick:function(){return!1}}}),usageVisualizationCharts.addSeries({name:"",data:[[p.getTime(),1.2*v]],marker:{enabled:!1},enableMouseTracking:!1,type:"line",color:"rgba(0,0,0,0)",showInLegend:!1,events:{legendItemClick:function(){return!1}},visible:!0}))}function a(t,i,n){var a=0,s=3e6,r=0,o=0,l=0;void 0!==n&&void 0!==n.userType&&(a=parseInt(n.userType)),void 0!==n&&void 0!==n.number_of_messages_per_unit&&(s=parseInt(n.number_of_messages_per_unit)),void 0!==n&&void 0!==n.display_recommended_units&&(r=parseInt(n.display_recommended_units)),void 0!==n&&void 0!==n.proposed_num_of_units&&(o=parseInt(n.proposed_num_of_units),l=1);var c={};if(c.Date=new Date((new Date).setFullYear((new Date).getFullYear()+1)),c.DateType="Expiration Date",c.DailyUsageRate=0,void 0===i||void 0===i.usages||0===i.usages.length)return c;if(void 0===t||void 0===t.units||0===t.units.length)return c;for(var u=new Date("2016-12-05"),d=0;d<t.units.length;d++)if(t.units[d].qty>0&&void 0!==t.units[d].endDate&&new Date(t.units[d].endDate)>u){var h=Date.UTC(t.units[d].endDate.split("-")[0],t.units[d].endDate.split("-")[1]-1,t.units[d].endDate.split("-")[2]);u=new Date(h+60*new Date(Date.now()).getTimezoneOffset()*1e3)}for(var p=new Date,f=p.getDate(),m=0,d=1;f>d;d++)m+=parseInt(i.usages[i.usages.length-d]);for(var g=e(t,s),_=g[0],v=g[1]+m,y=_-v,b=0,w=0,k=0,x=0,d=1;31>d;d++)b+=parseInt(i.usages[i.usages.length-d]),16>d&&(w+=parseInt(i.usages[i.usages.length-d])),8>d&&(k+=parseInt(i.usages[i.usages.length-d])),2>d&&(x+=parseInt(i.usages[i.usages.length-d]));var $=Math.ceil(b/30),D=Math.ceil(w/15),C=Math.ceil(k/7),T=x,S=1e-6;
0==$&&($=S),0==D&&(D=S),0==C&&(C=S),0==T&&(T=S);var E=Math.floor(y/$),P=Math.floor(y/D),I=Math.floor(y/C),M=Math.floor(y/T);E>365&&(E=365),P>365&&(P=365),I>365&&(I=365),M>365&&(M=365);var N=(new Date).getTime(),A=864e5,F=new Date(N+E*A),L=$;return 15*D>y&&(F=new Date(N+P*A),L=D),7*C>y&&(F=new Date(N+I*A),L=C),T>y&&(F=new Date(N+M*A),L=T),(p>F||0>y)&&(F=p),F>u||u.getFullYear()==F.getFullYear()&&u.getMonth()==F.getMonth()&&u.getDate()==F.getDate()?(c.Date=u,c.DateType="Expiration Date"):(c.Date=F,c.DateType="Exhaustion Date"),c.DailyUsageRate=Math.round(L),c}var s=864e5,r=[[0,114,189],[217,83,25],[237,177,32],[126,47,142],[119,172,48],[77,190,238],[162,20,47]],o=[["01",31],["02",28],["03",31],["04",30],["05",31],["06",30],["07",31],["08",31],["09",30],["10",31],["11",30],["12",31]],l=14,c=32;return{updateDailyUsageChart:n,updateMonthlyUsageChart:i,estimateExhaustionOrExpirationDate:a}}(),$(document).on("page:load ready",function(){if(0!==$("#sales_div").length){var e;e=user_info.is_free_user?user_info.free_license_id:user_info.is_a_staff?user_info.staff_license_id:$("#select_license").is("label")?$("#select_license").html():$("#select_license").val(),loadAccountsPage(e),$("#select_license").change(function(){loadAccountsPage($("#select_license").val())}),$('a[data-toggle="tab"]').on("shown.bs.tab",function(){usageVisualizationCharts&&usageVisualizationCharts.reflow();var e,t=/(width: )\w+/,i=document.getElementById("myTabContent").offsetWidth-50,n=$(".highcharts-container").attr("style");void 0!==n&&(e=n.replace(t,"width: "+i+"px"),$(".highcharts-container").attr("style",e));var n=$(".highcharts-loading").attr("style");void 0!==n&&(e=n.replace(t,"width: "+i+"px"),$(".highcharts-loading").attr("style",e))})}});var formatToLocale=function(e){return e=isNaN(parseInt(e))?"":e.toLocaleString()},accountsPageHelperFunctions={setLicenseType:function(e){for(i=0;i<license_types.length;i++)if(license_types[i].hasOwnProperty(e)){$("#license_type").html(license_types[i][e]);break}},setDivsForFreeUser:function(){$(".admin_div").hide(),$(".leu_div").hide(),$(".nde_leu_div").hide(),$(".nde_admin_div").hide(),$(".free_user_div").show(),$(".staff_div").hide()},populateFreeUserTable:function(){var e,t,i,n={"01":"Jan","02":"Feb","03":"Mar","04":"Apr","05":"May","06":"Jun","07":"Jul","08":"Aug","09":"Sep",10:"Oct",11:"Nov",12:"Dec"},a=user_info.licenses[0].end_date.split("-");e=a[2],t=n[a[1]],i=a[0];var s=user_info.licenses[0].messages_remaining;$("#free_unit_expiration_date").html(e+" "+t+" "+i),$("#free_messages_available").html(formatToLocale(Math.round(user_info.free_messages_per_year))),$("#free_messages_remaining").html(formatToLocale(s)),null!=channel_data&&($("#free_channels_available").html(channel_data[3]),$("#free_channels_remaining").html(channel_data[2]))},setLicenseUnavailableText:function(){var e='<tr><td colspan="3"><span class="text-danger break-word">'+rI18n.license_details_tmp_unavail+"</span></td></tr>";$("#free_user_messages_table2").append(e)},setAccountsPageForFreeUser:function(){1==user_info.has_exhausted&&(is_shutOff=!0),accountsPageHelperFunctions.setDivsForFreeUser(),jQuery.isEmptyObject(user_info.licenses)?accountsPageHelperFunctions.setLicenseUnavailableText():accountsPageHelperFunctions.populateFreeUserTable(),$("#suggested_daily_usage_rate_free_user").html("&nbsp;"+formatToLocale(Math.round(user_info.free_messages_per_year/365))+"&nbsp;messages"),populateFreeUnitsLink()},showErrorBanner:function(){$("#invalid_widget_type").show(),$("#configure_widget_parameters_modal").modal("toggle")},findChannelLimit:function(e,t){var i=offering_id_limit_hash[e];return i*t}},loadAccountsPage=function(e){null!=license_types&&accountsPageHelperFunctions.setLicenseType(e),setExhaustionAlertDefaults(),1==user_info.is_free_user?accountsPageHelperFunctions.setAccountsPageForFreeUser():($(".free_user_div").hide(),jQuery.isEmptyObject(user_info.licenses)?($(".admin_div").hide(),$(".leu_div").hide(),$(".nde_leu_div").hide(),$(".nde_admin_div").hide(),$(".staff_div").hide(),$(".license_info_unavail_div").show()):user_info.licenses.forEach(function(t){if(t.license_id==e){if(null!=t.has_exhausted&&(is_shutOff=!0),1==t.is_an_leu){is_leu=!0,1==t.is_an_nde_leu?($(".admin_div").hide(),$(".leu_div").hide(),$(".nde_admin_div").hide(),$(".nde_leu_div").show(),$(".staff_div").hide()):t.is_a_staff?($(".admin_div").hide(),$(".nde_leu_div").hide(),$(".nde_admin_div").hide(),$(".leu_div").hide(),$(".staff_div").show()):($(".admin_div").hide(),$(".nde_leu_div").hide(),$(".nde_admin_div").hide(),$(".leu_div").show(),$(".staff_div").hide());var i=!1;user_info.licenses.forEach(function(e){0==e.is_an_leu&&(i=!0)}),i?$(".pricing_link").hide():$(".pricing_link").show()}else 1==t.is_an_nde_admin?($(".admin_div").hide(),$(".leu_div").hide(),$(".nde_leu_div").hide(),$(".staff_div").hide(),$(".nde_admin_div").show()):($(".leu_div").hide(),$(".nde_leu_div").hide(),$(".nde_admin_div").hide(),$(".staff_div").hide(),$(".admin_div").show()),drawUnitsTable(t,e),populatePurchaseUnitsLink(e);populateAlertMessages(e,is_shutOff)}})),drawMessageUsageCharts(e),populateLicenceCenterLink(e)},drawUnitsTable=function(e,t){e.is_an_nde_admin?(salesDiv=$("#sales_div_nde"),suggested_daily_rate=$("#suggested_daily_usage_rate_nde")):(salesDiv=$("#sales_div"),suggested_daily_rate=$("#suggested_daily_usage_rate")),salesDiv.find("table").remove();var i=[],n=0;user_info.licenses.forEach(function(e){return e.license_id==t?(n+=1,i=e.units,!1):void 0});var a,s,r,o,l,c=0,u=[],d=[[0,114,189],[217,83,25],[237,177,32],[126,47,142],[119,172,48],[77,190,238],[162,20,47]],h=0,p=0,f=new Date(1970,1,1),m=new Date(1970,1,1),g=null;null!=channel_data&&(g=channel_data[4][t]);var n=0,_="",v="",y=!1,b="2019-02-13";i.forEach(function(e){expirationDateUTC=Date.UTC(e.end_date.split("-")[0],e.end_date.split("-")[1]-1,e.end_date.split("-")[2]),a=new Date(expirationDateUTC+60*new Date(Date.now()).getTimezoneOffset()*1e3),null!=g&&(a>=new Date?(y?v="N/A":(_=g[n][0],0===e.messages_remaining&&e.start_date<b?(v="N/A",y=!0):v=g[n][1]),n++):(_=accountsPageHelperFunctions.findChannelLimit(e.offering_id,e.qty),v=0)),s=(a.getDate()<10?"0":"")+a.getDate(),r=a.toLocaleString("en-us",{month:"short"}),o=a.getFullYear(),l=e.messages_allowed,messagesRemaining=e.messages_remaining,c+=messagesRemaining;var t="rgba("+d[h][0]+","+d[h][1]+","+d[h][2]+",1)",w="<table><colgroup><col class='col-sm-2 col-xs-6'><col class='col-sm-4 col-xs-12'></colgroup><tr><td class='text-left'><label>Units:</label><label style='font-weight: normal'>"+e.qty+"</label></td><td class='text-right'><label>Expiration Date: &nbsp</label><label style='font-weight: normal;'>"+(" "+s+" "+r+" "+o)+"&nbsp;<i class='fa fa-square units_box' style=color:"+t+" aria-hidden='true'></i></label></td></tr>",k="<table class='table table-bordered table-sm text-center pricing_results'><colgroup><col class='col-sm-2 col-xs-6'><col class='col-sm-2 col-xs-6'><col class='col-sm-2 col-xs-6'></colgroup><thead class='text-center'><tr><th scope='col'></th><th scope='col' class='text-center'>Purchased</th><th scope='col' class='text-center'>Remaining</th></tr></thead><tbody><tr><th scope='row'>Messages</th><td>"+l+"</td><td>"+messagesRemaining+"</td></tr><th scope='row'>Channels</th><td>"+_+"</td><td>"+v+"</td></tr></tbody></table>",x=w+k;h=(h+1)%d.length,a>new Date?(salesDiv.append(x),a>m&&(m=a)):(p+=1,a>f&&(f=a,trHTMLMAX=x),p===i.length&&salesDiv.append(trHTMLMAX)),checkForLicenseProdId(u,e,a)}),u.forEach(function(e){checkForUnitExpiration(e)});var w=Math.abs((new Date).getTime()-m.getTime()),k=Math.ceil(w/864e5);user_info.suggestedDailyRate=Math.round(c/k),suggested_daily_rate.html("&nbsp;"+formatToLocale(user_info.suggestedDailyRate)+"&nbsp;messages")},checkForLicenseProdId=function(e,t,i){e.push({key:t,value:i});for(var n in e)e[n].key.licensed_prod_id===t.licensed_prod_id&&1!=e.length&&e[n].key.id!=t.id&&checkDateForRenewal(e[n],i,e,n)},checkDateForRenewal=function(e,t,i,n){e.value<t?i.splice(n,1):i.splice(-1,1)},checkForUnitExpiration=function(e){var t=Math.abs(new Date(e.value).getTime()-(new Date).getTime()),i=Math.ceil(t/864e5),n=e.value.toISOString().split("T")[0]===(new Date).toISOString().split("T")[0];(e.value>new Date||n)&&60>=i&&renderRenewalsDiv(e)},renderRenewalsDiv=function(e){$("#purchase_units_link").addClass("btn-default"),$("#renew_units_link").show();var t='<div id="'+e.key.id+'renewals_div" class="alert alert-danger alert-dismissable renewals_expiration_alert" style="display:none; clear:both"><a href="#" class="close" data-dismiss="alert" aria-label="close">X</a><span>User purchase made on <strong><span name="renewal_start_date" id="'+e.key.id+'renewal_start_date"></span></strong> is going to expire on: <strong><span name="renewal_expiration_date" id="'+e.key.id+'renewal_expiration_date"></span></strong>.<i class="fa fa-exclamation-triangle" aria-hidden="true"></i><a id="'+e.key.id+'call_of_action_to_renew" class="exhaustion_alert" target="_blank">Renew units</a></span></div>';$("#exhaustion_div").append(t),$("#"+e.key.id+"renewal_start_date").text(moment(new Date(e.key.start_date)).format("LL")),$("#"+e.key.id+"renewal_expiration_date").text(moment(new Date(e.value)).format("LL")),populateRenewUnitsLink(e.key.id),$("#"+e.key.id+"renewals_div").show()},drawMessageUsageCharts=function(e){$("#spinner_daily").show(),$("#spinner_monthly").show();var t=!1,i=0;user_info.is_free_user||jQuery.isEmptyObject(user_info.licenses)||user_info.licenses.forEach(function(n){n.license_id==e&&(t=n.is_an_leu,i=n.total_remaining_messages_per_license)});var n={daily:void 0,monthly:void 0},a={userType:user_info.user_type};user_info.is_free_user?(a.number_of_messages_per_unit=user_info.free_messages_per_year,a.messages_remaining=user_info.licenses[0].messages_remaining):(a.number_of_messages_per_unit=user_info.messages_per_paid_unit,a.messages_remaining=i);var s=function(e){n.daily=e,o(n),$("#spinner_daily").hide(),UsageVisualizations.updateDailyUsageChart(e,"dailyMessageUsage",a,user_info.suggestedDailyRate)},r=function(e){n.monthly=e,o(n),$("#monthly_usage_tab").is(":visible")&&($("#spinner_monthly").hide(),UsageVisualizations.updateMonthlyUsageChart(e,"messageUnitUsage",a))},o=function(t){t.daily&&t.monthly&&checkMessageExhaustion(e,user_info,user_info.is_free_user,n,!0,a)},l=5e3,c={url:"/account/daily_usage.json",cache:!1,data:{lid:e,is_an_leu:t},dataType:"json",timeout:l};$.ajax(c).done(s).fail(function(e){304!=e.status?$.ajax(c).done(s).fail(function(){$("#spinner_daily").hide(),$("#dailyMessageUsageTmpUnavail").show()}):($("#spinner_daily").hide(),$("#dailyMessageUsageTmpUnavail").show())}),monthlyAjaxOptions={url:"/account/monthly_usage.json",cache:!1,data:{lid:e,is_an_leu:t},dataType:"json",timeout:l},$.ajax(monthlyAjaxOptions).done(r).fail(function(e){304!=e.status?$.ajax(monthlyAjaxOptions).done(r).fail(function(){$("#spinner_monthly").hide(),$("#messageUnitUsageTmpUnavail").show()}):($("#spinner_monthly").hide(),$("#messageUnitUsageTmpUnavail").show())})},populateLicenceCenterLink=function(e){var t=user_info.license_center_link;t=t.replace(":lid",encodeURIComponent(e)),$("#license_center_link").attr("href",t)},populateRenewUnitsLink=function(e){var t=user_info.licenses[user_info.licenses.length-1].license_id;renew_link=renew_units_link.replace(":lid",encodeURIComponent(t)),$("#"+e+"call_of_action_to_renew").attr("href",renew_link),$("#renew_units_link").attr("href",renew_link)};$(document).on("page:load ready",function(){var e=-90;$(".flash").length>0&&($(".flash").on("click",function(){$(this).hide("slow")}),setTimeout(function(){$("div.flash.alert.alert-success").length>0&&$(".flash").hide("slow")},15e3)),$("#talkback_command_add").click(function(){$(this).hide(),$("#talkback_command_add_form").removeClass("hide")}),$("#contact_link").click(function(){$("#contact_form").toggle()}),$(".tablesorter").length>0&&$(".tablesorter").tablesorter(),$("#userlogin_js").val("6H2W6QYUAJT1Q8EB"),$("input").not(".maxlength_exempt").attr("maxlength","80"),setTimeout(function(){if(""!==window.location.hash){var t=$(window.location.hash).offset().top+e;$(document).scrollTop(t)}},150)});